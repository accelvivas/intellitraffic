<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntelliTraffic - Smart Traffic Management System</title>
    <link rel="icon" href="images/logo1.png" type="image/png">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- iziToast for notifications -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/izitoast/dist/css/iziToast.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/izitoast/dist/js/iziToast.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            overflow-x: hidden;
        }
        
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
        }
        
        .mobile-menu {
            display: none;
        }
        
        .mobile-menu.active {
            display: block;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-25%);
            }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .animate-ping {
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        :root {
            --brand-primary: #1a3a52;   /* Navy */
            --brand-accent:  #06b6d4;   /* Cyan */
            --brand-purple:  #a855f7;   /* Purple */
            --brand-bg1:     var(--brand-primary);
            --brand-bg2:     var(--brand-purple);
            --brand-bg3:     #4338ca;   /* Indigo fallback */
        }

        /* Base typography for light sections */
        body { color: #0f172a; }
        a { color: var(--brand-accent); text-underline-offset: 3px; }
        a:hover { color: #0891b2; }

        .gradient-bg {
            background: linear-gradient(135deg, var(--brand-bg1) 0%, var(--brand-bg2) 50%, var(--brand-bg3) 100%);
        }

        /* Hero with traffic image background */
        .hero-traffic {
            position: relative;
            background-image: url('images/traffic.jpg');
            background-size: cover;
            background-position: center;
        }
        /* Dark overlay for contrast on hero */
        .hero-traffic::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(26,58,82,0.70) 0%, rgba(26,58,82,0.78) 40%, rgba(26,58,82,0.86) 100%);
            pointer-events: none;
        }
        /* Slight text lift on image backgrounds */
        .elevate-text { text-shadow: 0 1px 2px rgba(0,0,0,0.45); }
        /* Chart container to prevent stretching */
        .chart-container { position: relative; height: 300px; }
        @media (min-width: 1024px) { .chart-container { height: 320px; } }
        
        /* Themed dark panels for key pages */
        #traffic-map-page .p-6.bg-white,
        #analytics-page .p-6.bg-white,
        #incident-reporter-page .p-6.bg-white,
        #admin-console-page .p-6.bg-white,
        #prediction-page .p-6.bg-white,
        #reporting-page .p-6.bg-white,
        #profile-page .p-6.bg-white {
            background-color: rgba(26,58,82,0.92) !important; /* brand navy */
            border-color: rgba(6,182,212,0.25) !important;    /* brand cyan border */
            color: #e6f9ff; /* light foreground */
        }
        #traffic-map-page .p-6.bg-white h3,
        #analytics-page .p-6.bg-white h3,
        #incident-reporter-page .p-6.bg-white h3,
        #admin-console-page .p-6.bg-white h3,
        #prediction-page .p-6.bg-white h3,
        #reporting-page .p-6.bg-white h3,
        #profile-page .p-6.bg-white h3,
        #traffic-map-page .p-6.bg-white .text-gray-900,
        #analytics-page .p-6.bg-white .text-gray-900,
        #incident-reporter-page .p-6.bg-white .text-gray-900,
        #admin-console-page .p-6.bg-white .text-gray-900,
        #prediction-page .p-6.bg-white .text-gray-900,
        #reporting-page .p-6.bg-white .text-gray-900,
        #profile-page .p-6.bg-white .text-gray-900,
        #traffic-map-page .p-6.bg-white .text-slate-900,
        #analytics-page .p-6.bg-white .text-slate-900,
        #incident-reporter-page .p-6.bg-white .text-slate-900,
        #admin-console-page .p-6.bg-white .text-slate-900,
        #prediction-page .p-6.bg-white .text-slate-900,
        #reporting-page .p-6.bg-white .text-slate-900,
        #profile-page .p-6.bg-white .text-slate-900 { color: #e6f9ff !important; }
        #traffic-map-page .p-6.bg-white .text-gray-700,
        #analytics-page .p-6.bg-white .text-gray-700,
        #incident-reporter-page .p-6.bg-white .text-gray-700,
        #admin-console-page .p-6.bg-white .text-gray-700,
        #prediction-page .p-6.bg-white .text-gray-700,
        #reporting-page .p-6.bg-white .text-gray-700,
        #profile-page .p-6.bg-white .text-gray-700,
        #traffic-map-page .p-6.bg-white .text-slate-700,
        #analytics-page .p-6.bg-white .text-slate-700,
        #incident-reporter-page .p-6.bg-white .text-slate-700,
        #admin-console-page .p-6.bg-white .text-slate-700,
        #prediction-page .p-6.bg-white .text-slate-700,
        #reporting-page .p-6.bg-white .text-slate-700,
        #profile-page .p-6.bg-white .text-slate-700 { color: #d3f0f7 !important; }
        #traffic-map-page .p-6.bg-white .text-gray-600,
        #analytics-page .p-6.bg-white .text-gray-600,
        #incident-reporter-page .p-6.bg-white .text-gray-600,
        #traffic-map-page .p-6.bg-white .text-slate-600,
        #analytics-page .p-6.bg-white .text-slate-600,
        #incident-reporter-page .p-6.bg-white .text-slate-600 { color: #b6e3ef !important; }

        /* Darken page backgrounds to match brand and reduce glare */
        #traffic-map-page,
        #analytics-page,
        #incident-reporter-page,
        #admin-console-page,
        #prediction-page,
        #reporting-page,
        #profile-page {
            background: linear-gradient(180deg, #0f172a 0%, #1a3a52 100%) !important;
        }

        /* Inputs and controls in dark panels */
        #incident-reporter-page input,
        #incident-reporter-page textarea,
        #incident-reporter-page select,
        #traffic-map-page .rounded-lg.border,
        #analytics-page .rounded-lg.border,
        #admin-console-page .rounded-lg.border,
        #prediction-page .rounded-lg.border,
        #reporting-page .rounded-lg.border,
        #profile-page .rounded-lg.border,
        #profile-page input,
        #profile-page select,
        #profile-page textarea {
            background-color: rgba(255,255,255,0.06) !important;
            border-color: rgba(6,182,212,0.25) !important;
            color: #e6f9ff !important;
        }
        #incident-reporter-page ::placeholder { color: #b6e3ef; opacity: .7; }
        #incident-reporter-page label { color: #d3f0f7; }

        /* Buttons inside dark panels */
        #traffic-map-page button,
        #analytics-page button,
        #incident-reporter-page button,
        #admin-console-page button,
        #prediction-page button,
        #reporting-page button,
        #profile-page button {
            background-color: #06b6d4; /* brand accent */
            color: #0b2435;
            border: 1px solid rgba(6,182,212,0.35);
        }
        #traffic-map-page button:hover,
        #analytics-page button:hover,
        #incident-reporter-page button:hover,
        #admin-console-page button:hover,
        #prediction-page button:hover,
        #reporting-page button:hover,
        #profile-page button:hover { background-color: #0891b2; }

        /* Typography: harmonize text colors on dark pages */
        #traffic-map-page h1,
        #traffic-map-page h2,
        #traffic-map-page h3,
        #traffic-map-page h4,
        #analytics-page h1,
        #analytics-page h2,
        #analytics-page h3,
        #analytics-page h4,
        #incident-reporter-page h1,
        #incident-reporter-page h2,
        #incident-reporter-page h3,
        #incident-reporter-page h4,
        #admin-console-page h1,
        #admin-console-page h2,
        #admin-console-page h3,
        #admin-console-page h4,
        #prediction-page h1,
        #prediction-page h2,
        #prediction-page h3,
        #prediction-page h4,
        #reporting-page h1,
        #reporting-page h2,
        #reporting-page h3,
        #reporting-page h4,
        #profile-page h1,
        #profile-page h2,
        #profile-page h3,
        #profile-page h4 {
            color: #ffffff !important;
        }
        #traffic-map-page p,
        #traffic-map-page li,
        #traffic-map-page span,
        #analytics-page p,
        #analytics-page li,
        #analytics-page span,
        #incident-reporter-page p,
        #incident-reporter-page li,
        #incident-reporter-page span,
        #admin-console-page p,
        #admin-console-page li,
        #admin-console-page span,
        #prediction-page p,
        #prediction-page li,
        #prediction-page span,
        #reporting-page p,
        #reporting-page li,
        #reporting-page span,
        #profile-page p,
        #profile-page li,
        #profile-page span {
            color: #d3f0f7;
        }
        /* Map utility grays to brand-friendly tones within dark pages */
        #traffic-map-page .text-gray-900,
        #analytics-page .text-gray-900,
        #incident-reporter-page .text-gray-900,
        #traffic-map-page .text-slate-900,
        #analytics-page .text-slate-900,
        #incident-reporter-page .text-slate-900 { color: #e6f9ff !important; }
        #traffic-map-page .text-gray-800,
        #analytics-page .text-gray-800,
        #incident-reporter-page .text-gray-800 { color: #def6fb !important; }
        #traffic-map-page .text-gray-700,
        #analytics-page .text-gray-700,
        #incident-reporter-page .text-gray-700 { color: #d3f0f7 !important; }
        #traffic-map-page .text-gray-600,
        #analytics-page .text-gray-600,
        #incident-reporter-page .text-gray-600 { color: #b6e3ef !important; }
        #traffic-map-page .text-gray-500,
        #analytics-page .text-gray-500,
        #incident-reporter-page .text-gray-500 { color: #9bd3e3 !important; }
        /* Ensure any forced black text still reads well on dark */
        #traffic-map-page .text-black,
        #analytics-page .text-black,
        #incident-reporter-page .text-black { color: #eafaff !important; }
        
        /* Incident Reporter: darken light tiles in Recent Community Reports and helper panel */
        #incident-reporter-page .bg-gray-50 { background-color: rgba(255,255,255,0.06) !important; }
        #incident-reporter-page .bg-blue-50 { background-color: rgba(6,182,212,0.12) !important; }
        #incident-reporter-page .border-gray-200 { border-color: rgba(6,182,212,0.25) !important; }
        #incident-reporter-page .border-gray-300 { border-color: rgba(6,182,212,0.3) !important; }
        #incident-reporter-page .hover\:border-gray-400:hover { border-color: rgba(6,182,212,0.45) !important; }

        /* Incident Reporter: custom dark select styling */
        #incident-reporter-page select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-color: rgba(255,255,255,0.06) !important;
            border-color: rgba(6,182,212,0.3) !important;
            color: #e6f9ff !important;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' fill='none' viewBox='0 0 24 24' stroke='%23b6e3ef' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 18px 18px;
            padding-right: 2.5rem !important;
        }
        #incident-reporter-page select:focus {
            outline: none !important;
            box-shadow: 0 0 0 3px rgba(6,182,212,0.35) !important;
            border-color: rgba(6,182,212,0.55) !important;
        }
        #incident-reporter-page option {
            background-color: #0b2435;
            color: #e6f9ff;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .traffic-point {
            transition: transform 0.2s;
        }
        
        .traffic-point:hover {
            transform: scale(1.2);
        }

        /* Ensure navbar stays above Leaflet controls */
        .leaflet-top, .leaflet-bottom { z-index: 40 !important; }
        .leaflet-control-container { z-index: 40 !important; }
        .leaflet-container { z-index: 10 !important; }
        
        @media (max-width: 768px) {
            .desktop-nav {
                display: none;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-menu-btn {
                display: none;
            }
        }

        /* Navbar hover/active effects */
        .nav-btn,
        .mobile-nav-btn {
            position: relative;
            transition: color .2s ease, background-color .2s ease, transform .15s ease;
        }

        .nav-btn::after {
            content: "";
            position: absolute;
            left: 12px;
            right: 12px;
            bottom: 6px;
            height: 2px;
            background: #06b6d4;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform .25s ease;
            opacity: .85;
        }

        .nav-btn:hover {
            color: #06b6d4;
            background-color: #f1f5f9;
        }

        .nav-btn:hover::after {
            transform: scaleX(1);
        }

        .nav-btn:active,
        .mobile-nav-btn:active {
            transform: translateY(1px) scale(0.98);
        }

        .mobile-nav-btn:hover {
            background-color: #f1f5f9;
            color: #0f172a;
        }

        /* Fade-up reveal animation */
        [data-animate] {
            opacity: 0;
            transform: translateY(24px);
        }
        [data-animate].in {
            opacity: 1;
            transform: translateY(0);
            transition: transform .6s cubic-bezier(0.22, 1, 0.36, 1), opacity .6s ease-out;
            transition-delay: var(--delay, 0s);
            will-change: transform, opacity;
        }
    </style>
</head>

<!-- Leaflet CSS for live map -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin=""
>
<!-- Leaflet JS for live map -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>
<body class="bg-white">
    <!-- Navigation Bar -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 z-50 bg-white/95 backdrop-blur-sm border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center gap-2 cursor-pointer" onclick="navigateTo('home')">
                    <img src="images/logo1.png" alt="IntelliTraffic Logo" class="h-8 w-8 rounded-lg object-contain bg-white/90" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"/>
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-600 to-purple-600 hidden items-center justify-center">
                        <i data-lucide="map-pin" class="w-5 h-5 text-white"></i>
                    </div>
                    <span class="text-xl font-semibold" style="color: var(--brand-primary)">Intelli<span style="color: var(--brand-accent)">Traffic</span></span>
                </div>

                <!-- Desktop Navigation -->
                <div class="desktop-nav hidden md:flex items-center gap-1">
                    <button onclick="navigateTo('home')" class="nav-btn px-3 py-2 rounded-lg flex items-center gap-2" data-page="home">
                        <i data-lucide="home" class="w-4 h-4"></i>
                        <span>Home</span>
                    </button>
                    <button onclick="navigateTo('traffic-map')" class="nav-btn px-3 py-2 rounded-lg flex items-center gap-2" data-page="traffic-map">
                        <i data-lucide="map-pin" class="w-4 h-4"></i>
                        <span>Traffic Map</span>
                    </button>
                    <button onclick="navigateTo('route-planner')" class="nav-btn px-3 py-2 rounded-lg flex items-center gap-2" data-page="route-planner">
                        <i data-lucide="navigation" class="w-4 h-4"></i>
                        <span>Route Planner</span>
                    </button>
                    <div class="relative">
                        <button id="moreBtn" class="nav-btn px-3 py-2 rounded-lg flex items-center gap-2" onclick="toggleMoreDropdown()">
                            <i data-lucide="chevron-down" class="w-4 h-4"></i>
                            <span>More</span>
                        </button>
                        <div id="moreDropdown" class="hidden absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
                            <div class="py-1">
                                <button onclick="navigateTo('analytics')" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"><i data-lucide='bar-chart-3' class='w-4 h-4'></i><span>Analytics</span></button>
                                <button onclick="navigateTo('incident-reporter')" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"><i data-lucide='alert-triangle' class='w-4 h-4'></i><span>Report Incident</span></button>
                                <button onclick="navigateTo('admin-console')" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"><i data-lucide='settings' class='w-4 h-4'></i><span>Admin Console</span></button>
                                <button onclick="navigateTo('prediction')" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"><i data-lucide='activity' class='w-4 h-4'></i><span>Prediction</span></button>
                                <button onclick="navigateTo('reporting')" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"><i data-lucide='file-down' class='w-4 h-4'></i><span>Reporting</span></button>
                                <button onclick="navigateTo('profile')" class="w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center gap-2"><i data-lucide='user' class='w-4 h-4'></i><span>Profile</span></button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile Menu Button -->
                <button class="mobile-menu-btn md:hidden p-2 rounded-lg hover:bg-gray-100" onclick="toggleMobileMenu()">
                    <i data-lucide="menu" class="w-6 h-6 text-gray-900"></i>
                </button>
            </div>

            <!-- Mobile Navigation -->
            <div id="mobileMenu" class="mobile-menu md:hidden py-4 border-t border-gray-200">
                <div class="space-y-1">
                    <button onclick="navigateTo('home')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="home">
                        <i data-lucide="home" class="w-5 h-5"></i>
                        <span>Home</span>
                    </button>
                    <button onclick="navigateTo('traffic-map')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="traffic-map">
                        <i data-lucide="map-pin" class="w-5 h-5"></i>
                        <span>Traffic Map</span>
                    </button>
                    <button onclick="navigateTo('route-planner')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="route-planner">
                        <i data-lucide="navigation" class="w-5 h-5"></i>
                        <span>Route Planner</span>
                    </button>
                    <button onclick="navigateTo('analytics')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="analytics">
                        <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                        <span>Analytics</span>
                    </button>
                    <button onclick="navigateTo('incident-reporter')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="incident-reporter">
                        <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                        <span>Report Incident</span>
                    </button>
                    <button onclick="navigateTo('admin-console')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="admin-console">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                        <span>Admin Console</span>
                    </button>
                    <button onclick="navigateTo('prediction')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="prediction">
                        <i data-lucide="activity" class="w-5 h-5"></i>
                        <span>Prediction</span>
                    </button>
                    <button onclick="navigateTo('reporting')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="reporting">
                        <i data-lucide="file-down" class="w-5 h-5"></i>
                        <span>Reporting</span>
                    </button>
                    <button onclick="navigateTo('profile')" class="mobile-nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100" data-page="profile">
                        <i data-lucide="user" class="w-5 h-5"></i>
                        <span>Profile</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-16">
        <!-- Home Page -->
        <div id="home-page" class="page-section active">
            <!-- Hero Section -->
            <div class="relative min-h-screen flex items-center justify-center overflow-hidden hero-traffic">
                <!-- Background Decorations -->
                <div class="absolute top-20 left-20 w-72 h-72 bg-blue-500/20 rounded-full blur-3xl animate-pulse"></div>
                <div class="absolute bottom-20 right-20 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
                <div class="absolute top-1/2 left-1/2 w-64 h-64 bg-indigo-500/20 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>

                <!-- Content -->
                <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 text-center elevate-text">
                    <!-- Badge -->
                   

                    <!-- Main heading -->
                    <h1 class="text-5xl sm:text-6xl lg:text-7xl text-white mb-6 font-bold tracking-tight">
                        IntelliTraffic
                    </h1>
                    <p class="text-2xl sm:text-3xl lg:text-4xl text-blue-200 mb-8 max-w-4xl mx-auto">
                        Leveraging Past Traffic Data and Predictive Analytics for Smarter Congestion Control
                    </p>

                    <!-- Stats -->
                    <div class="flex flex-wrap justify-center gap-8 mb-12">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-green-500/20 border border-green-500/40 flex items-center justify-center">
                                <i data-lucide="trending-down" class="w-6 h-6 text-green-400"></i>
                            </div>
                            <div class="text-left">
                                <div class="text-2xl font-bold text-white">₱3.5B</div>
                                <div class="text-white/60">Daily losses reduced</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-full bg-blue-500/20 border border-blue-500/40 flex items-center justify-center">
                                <i data-lucide="map-pin" class="w-6 h-6 text-blue-400"></i>
                            </div>
                            <div class="text-left">
                                <div class="text-2xl font-bold text-white">Real-time</div>
                                <div class="text-white/60">Traffic predictions</div>
                            </div>
                        </div>
                    </div>

                    <!-- CTAs -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                        <button onclick="scrollToFeatures()" class="px-6 py-3 bg-white text-blue-900 rounded-lg font-semibold hover:bg-blue-50 transition-colors flex items-center gap-2">
                            Explore Features
                            <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                        <button onclick="navigateTo('traffic-map')" class="px-6 py-3 border-2 border-white/30 text-white rounded-lg font-semibold hover:bg-white/10 transition-colors">
                            Try Demo
                        </button>
                    </div>
                </div>

                <!-- Scroll indicator -->
                <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-10">
                    <div class="w-6 h-10 border-2 border-white/30 rounded-full flex justify-center p-2">
                        <div class="w-1 h-3 bg-white/60 rounded-full animate-bounce"></div>
                    </div>
                </div>
            </div>

            <!-- Features Section -->
            <section id="features" class="py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white">
                <div class="max-w-7xl mx-auto">
                    <!-- Header -->
                    <div class="text-center mb-16">
                        <div class="inline-block px-4 py-2 bg-blue-100 text-blue-700 rounded-full mb-4 font-semibold">
                            Core Features
                        </div>
                        <h2 class="text-4xl sm:text-5xl text-gray-900 mb-4 font-bold">
                            Intelligent Traffic Solutions
                        </h2>
                        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                            A comprehensive system combining cutting-edge technology with practical urban traffic management
                        </p>
                    </div>

                    <!-- Features grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="p-6 bg-white rounded-lg border border-gray-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                            <div class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center mb-4">
                                <i data-lucide="brain" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Predictive Analytics</h3>
                            <p class="text-gray-600">Machine learning models using LSTM and ensemble learning to forecast traffic conditions with high accuracy.</p>
                        </div>

                        <div class="p-6 bg-white rounded-lg border border-gray-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                            <div class="w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center mb-4">
                                <i data-lucide="cloud" class="w-6 h-6 text-purple-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Real-time Data Integration</h3>
                            <p class="text-gray-600">Combines historical traffic data, weather conditions, and incident reports for comprehensive predictions.</p>
                        </div>

                        <div class="p-6 bg-white rounded-lg border border-gray-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                            <div class="w-12 h-12 rounded-lg bg-orange-100 flex items-center justify-center mb-4">
                                <i data-lucide="bell" class="w-6 h-6 text-orange-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Smart Alerts</h3>
                            <p class="text-gray-600">Proactive notifications for predicted congestion hotspots and alternative route suggestions.</p>
                        </div>

                        <div class="p-6 bg-white rounded-lg border border-gray-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                            <div class="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center mb-4">
                                <i data-lucide="map" class="w-6 h-6 text-green-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Interactive Mapping</h3>
                            <p class="text-gray-600">Visual heatmaps and route planning with predicted travel times for commuters.</p>
                        </div>

                        <div class="p-6 bg-white rounded-lg border border-gray-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                            <div class="w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center mb-4">
                                <i data-lucide="bar-chart-3" class="w-6 h-6 text-indigo-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Data Visualization</h3>
                            <p class="text-gray-600">Comprehensive dashboards for traffic managers with historical charts and analytics.</p>
                        </div>

                        <div class="p-6 bg-white rounded-lg border border-gray-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                            <div class="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center mb-4">
                                <i data-lucide="shield" class="w-6 h-6 text-gray-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Privacy-First Design</h3>
                            <p class="text-gray-600">Anonymized data processing with secure, encrypted communications throughout the system.</p>
                        </div>

                        <div class="p-6 bg-white rounded-lg border border-gray-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                            <div class="w-12 h-12 rounded-lg bg-teal-100 flex items-center justify-center mb-4">
                                <i data-lucide="smartphone" class="w-6 h-6 text-teal-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Cross-Platform</h3>
                            <p class="text-gray-600">Seamless experience across web and mobile platforms with offline caching capabilities.</p>
                        </div>

                        <div class="p-6 bg-white rounded-lg border border-gray-200 hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                            <div class="w-12 h-12 rounded-lg bg-yellow-100 flex items-center justify-center mb-4">
                                <i data-lucide="zap" class="w-6 h-6 text-yellow-600"></i>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">High Performance</h3>
                            <p class="text-gray-600">Optimized inference with sub-500ms response times for real-time traffic predictions.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Links Section -->
            <section class="py-16 px-4 sm:px-6 lg:px-8 gradient-bg">
                <div class="max-w-7xl mx-auto text-center">
                    <h2 class="text-3xl font-bold text-white mb-4">
                        Explore IntelliTraffic Features
                    </h2>
                    <p class="text-blue-200 mb-8 max-w-2xl mx-auto">
                        Navigate through our interactive prototype to experience the full capabilities of the system
                    </p>
                    <div class="flex flex-wrap justify-center gap-4">
                        <button onclick="navigateTo('traffic-map')" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors">
                            View Traffic Map
                        </button>
                        <button onclick="navigateTo('route-planner')" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
                            Plan a Route
                        </button>
                        <button onclick="navigateTo('analytics')" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition-colors">
                            View Analytics
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Traffic Map Page -->
        <div id="traffic-map-page" class="page-section min-h-screen py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-gray-50">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-12">
                    <div class="inline-block px-4 py-2 bg-blue-100 text-blue-700 rounded-full mb-4 font-semibold">
                        Live Traffic Intelligence
                    </div>
                    <h2 class="text-4xl sm:text-5xl text-white mb-4 font-bold">
                        Real-Time Traffic Prediction Map
                    </h2>
                    <p class="text-xl text-gray-400 max-w-3xl mx-auto in">
                        AI-powered predictions showing current and forecasted traffic conditions
                    </p>
                </div>

                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Map View -->
                    <div class="lg:col-span-2">
                        <div class="p-6 bg-white rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-semibold text-gray-900">Metro Manila Traffic</h3>
                                <div class="flex gap-2">
                                    <button onclick="toggleMapView('current')" id="currentViewBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg font-medium">Current</button>
                                    <button onclick="toggleMapView('predicted')" id="predictedViewBtn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium">Predicted (1hr)</button>
                                </div>
                            </div>

                            <!-- Map Container -->
                            <div class="relative bg-gray-100 rounded-lg h-96 overflow-hidden">
                                <!-- Live Leaflet map renders here -->
                                <div id="leafletMap" class="absolute inset-0 z-0"></div>

                                <!-- Legend -->
                                <div class="absolute bottom-4 right-4 bg-white/95 backdrop-blur-sm rounded-lg p-3 shadow-lg">
                                    <div class="space-y-2">
                                        <div class="flex items-center gap-2">
                                            <div class="w-3 h-3 rounded-full bg-red-500"></div>
                                            <span class="text-sm text-black">High Congestion</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                                            <span class="text-sm text-black">Medium</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                            <span class="text-sm text-black">Low</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Side Panel -->
                    <div class="space-y-6">
                        <!-- Predictions -->
                        <div class="p-6 bg-white rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center gap-2 mb-4">
                                <i data-lucide="trending-up" class="w-5 h-5 text-blue-600"></i>
                                <h3 class="text-lg font-semibold text-gray-900">Traffic Forecast</h3>
                            </div>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">Now</span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-32 bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="h-full bg-yellow-500" style="width: 75%"></div>
                                        </div>
                                        <span class="text-gray-900 font-semibold">75%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">30 min</span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-32 bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="h-full bg-red-500" style="width: 82%"></div>
                                        </div>
                                        <span class="text-gray-900 font-semibold">82%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">1 hr</span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-32 bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="h-full bg-red-500" style="width: 90%"></div>
                                        </div>
                                        <span class="text-gray-900 font-semibold">90%</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-600">2 hr</span>
                                    <div class="flex items-center gap-2">
                                        <div class="w-32 bg-gray-200 rounded-full h-2 overflow-hidden">
                                            <div class="h-full bg-yellow-500" style="width: 65%"></div>
                                        </div>
                                        <span class="text-gray-900 font-semibold">65%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Active Alerts -->
                        <div class="p-6 bg-white rounded-lg shadow-sm border border-gray-200">
                            <div class="flex items-center gap-2 mb-4">
                                <i data-lucide="alert-triangle" class="w-5 h-5 text-orange-600"></i>
                                <h3 class="text-lg font-semibold text-gray-900">Active Alerts</h3>
                            </div>
                            <div class="space-y-3">
                                <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                                    <span class="inline-block px-2 py-1 bg-red-600 text-white text-xs rounded mb-2 font-semibold">High Priority</span>
                                    <p class="text-sm text-gray-700">EDSA northbound: Heavy congestion expected in 30 min</p>
                                </div>
                                <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <span class="inline-block px-2 py-1 bg-yellow-600 text-white text-xs rounded mb-2 font-semibold">Medium</span>
                                    <p class="text-sm text-gray-700">C5 roadwork causing delays near Ortigas</p>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="p-6 bg-white rounded-lg shadow-sm border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                            <div class="space-y-2">
                                <button onclick="navigateTo('route-planner')" class="w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    <i data-lucide="navigation" class="w-4 h-4"></i>
                                    Plan Route
                                </button>
                                <button onclick="navigateTo('incident-reporter')" class="w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    <i data-lucide="alert-triangle" class="w-4 h-4"></i>
                                    Report Incident
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Route Planner Page -->
        <div id="route-planner-page" class="page-section min-h-screen py-24 px-4 sm:px-6 lg:px-8 bg-gray-900">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-12">
                    <div class="inline-block px-4 py-2 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded-full mb-4 font-semibold">
                        Smart Route Planning
                    </div>
                    <h2 class="text-4xl sm:text-5xl text-white mb-4 font-bold">
                        AI-Powered Route Optimization
                    </h2>
                    <p class="text-xl text-gray-400 max-w-3xl mx-auto">
                        Get the best route with predicted travel times based on historical data and real-time conditions
                    </p>
                </div>

                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Input Form -->
                    <div class="p-6 bg-gray-800 rounded-lg border border-gray-700">
                        <h3 class="text-xl font-semibold text-white mb-6">Plan Your Route</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Starting Point</label>
                                <div class="relative">
                                    <input type="text" id="routeOrigin" value="Quezon City Hall" class="w-full pl-10 pr-4 py-2 bg-gray-900 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter origin or use GPS">
                                    <i data-lucide="map-pin" class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                                </div>
                                <button id="routeUseMyLocationBtn" type="button" class="mt-2 flex items-center gap-2 px-3 py-2 text-sm bg-gray-700 border border-gray-600 rounded-lg hover:bg-gray-600 transition-colors">
                                    <i data-lucide="navigation" class="w-4 h-4"></i>
                                    Use My Current Location
                                </button>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Destination</label>
                                <div class="relative">
                                    <input type="text" id="routeDestination" value="Makati CBD" class="w-full pl-10 pr-4 py-2 bg-gray-900 border border-gray-600 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter destination">
                                    <i data-lucide="navigation" class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Departure Time</label>
                                <select id="routeDepartureTime" class="w-full px-4 py-2 bg-gray-900 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="now">Leave Now</option>
                                    <option value="30min">In 30 minutes</option>
                                    <option value="1hr">In 1 hour</option>
                                    <option value="2hr">In 2 hours</option>
                                    <option value="custom">Custom Time</option>
                                </select>
                                <input type="datetime-local" id="routeCustomTime" class="mt-2 w-full px-4 py-2 bg-gray-900 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 hidden" />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Travel Mode</label>
                                <select id="routeMode" class="w-full px-4 py-2 bg-gray-900 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="driving">Driving (Road)</option>
                                    <option value="ferry">Ferry (Experimental)</option>
                                    <option value="flight">Flight (Experimental)</option>
                                    <option value="transit">Public Transit (Requires API)</option>
                                </select>
                                <p class="mt-1 text-xs text-gray-500">Transit needs an API key (e.g., Google Directions). Ferry/Flight are estimated.</p>
                            </div>

                            <button onclick="showRouteResults()" class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors">
                                <i data-lucide="navigation" class="w-4 h-4"></i>
                                Find Best Routes
                            </button>
                        </div>

                        <!-- Stats -->
                        <div class="mt-6 pt-6 border-t border-gray-700">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <div class="text-2xl font-bold text-white">95%</div>
                                    <div class="text-sm text-gray-400">Accuracy</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-white">-18min</div>
                                    <div class="text-sm text-gray-400">Avg. Savings</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Route Results -->
                    <div class="lg:col-span-2 space-y-4">
                        <div id="routeMap" class="h-64 bg-gray-800 rounded-lg border border-gray-700"></div>
                        <div id="routeResults" class="space-y-4">
                            <div class="p-12 bg-gray-800 rounded-lg border border-gray-700 text-center">
                                <i data-lucide="navigation" class="w-16 h-16 text-gray-600 mx-auto mb-4"></i>
                                <h3 class="text-xl font-semibold text-gray-400 mb-2">Enter your route details</h3>
                                <p class="text-gray-500">
                                    Fill in the origin and destination to get AI-powered route recommendations
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analytics-page" class="page-section min-h-screen py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-12">
                    <div class="inline-block px-4 py-2 bg-purple-100 text-purple-700 rounded-full mb-4 font-semibold">
                        Analytics Dashboard
                    </div>
                    <h2 class="text-4xl sm:text-5xl text-white mb-4 font-bold">
                        Traffic Intelligence & Analytics
                    </h2>
                    <p class="text-xl text-gray-400 max-w-3xl mx-auto in">
                        Real-time insights and predictive analytics for data-driven traffic management
                    </p>
                </div>

                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center">
                                <i data-lucide="activity" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded mb-2 font-semibold">+12%</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-900 mb-1">95.2%</div>
                        <p class="text-gray-600">Prediction Accuracy</p>
                    </div>

                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-orange-100 flex items-center justify-center">
                                <i data-lucide="alert-circle" class="w-6 h-6 text-orange-600"></i>
                            </div>
                            <span class="px-2 py-1 bg-red-100 text-red-700 text-xs rounded mb-2 font-semibold">-5%</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-900 mb-1">32</div>
                        <p class="text-gray-600">Active Incidents</p>
                    </div>

                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center">
                                <i data-lucide="trending-down" class="w-6 h-6 text-green-600"></i>
                            </div>
                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded mb-2 font-semibold">-18min</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-900 mb-1">18 min</div>
                        <p class="text-gray-600">Avg. Time Saved</p>
                    </div>

                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div class="w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center">
                                <i data-lucide="check-circle" class="w-6 h-6 text-purple-600"></i>
                            </div>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded mb-2 font-semibold">Live</span>
                        </div>
                        <div class="text-3xl font-bold text-gray-900 mb-1">156K</div>
                        <p class="text-gray-600">Active Users</p>
                    </div>
                </div>

                <!-- Charts -->
                <div class="grid lg:grid-cols-2 gap-6 mb-8">
                    <!-- Traffic Flow Chart -->
                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">Traffic Flow: Actual vs Predicted</h3>
                            <span class="px-3 py-1 border border-gray-300 rounded-lg text-sm text-gray-600">Today</span>
                        </div>
                        <div class="chart-container"><canvas id="trafficFlowChart"></canvas></div>
                    </div>

                    <!-- Weekly Trends Chart -->
                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-900">Weekly Congestion Trends</h3>
                            <span class="px-3 py-1 border border-gray-300 rounded-lg text-sm text-gray-600">This Week</span>
                        </div>
                        <div class="chart-container"><canvas id="weeklyTrendsChart"></canvas></div>
                    </div>
                </div>

                <!-- Congestion by Area -->
                <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Congestion Levels by Major Corridor</h3>
                        <div class="flex items-center gap-2 text-gray-600">
                            <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                            <span>Live Data</span>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span class="font-medium text-gray-900">EDSA</span>
                                    <span class="px-2 py-1 border border-gray-300 rounded text-xs text-gray-600">12 incidents</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="trending-up" class="w-4 h-4 text-red-600"></i>
                                    <span class="font-semibold text-gray-900 min-w-12 text-right">85%</span>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="h-full bg-red-500 transition-all" style="width: 85%"></div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span class="font-medium text-gray-900">C5</span>
                                    <span class="px-2 py-1 border border-gray-300 rounded text-xs text-gray-600">5 incidents</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="activity" class="w-4 h-4 text-yellow-600"></i>
                                    <span class="font-semibold text-gray-900 min-w-12 text-right">62%</span>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="h-full bg-yellow-500 transition-all" style="width: 62%"></div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span class="font-medium text-gray-900">España</span>
                                    <span class="px-2 py-1 border border-gray-300 rounded text-xs text-gray-600">8 incidents</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="trending-up" class="w-4 h-4 text-yellow-600"></i>
                                    <span class="font-semibold text-gray-900 min-w-12 text-right">78%</span>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="h-full bg-yellow-500 transition-all" style="width: 78%"></div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span class="font-medium text-gray-900">Ortigas</span>
                                    <span class="px-2 py-1 border border-gray-300 rounded text-xs text-gray-600">3 incidents</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="trending-down" class="w-4 h-4 text-green-600"></i>
                                    <span class="font-semibold text-gray-900 min-w-12 text-right">45%</span>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="h-full bg-green-500 transition-all" style="width: 45%"></div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span class="font-medium text-gray-900">Roxas Blvd</span>
                                    <span class="px-2 py-1 border border-gray-300 rounded text-xs text-gray-600">4 incidents</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="trending-down" class="w-4 h-4 text-green-600"></i>
                                    <span class="font-semibold text-gray-900 min-w-12 text-right">55%</span>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="h-full bg-yellow-500 transition-all" style="width: 55%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Incident Reporter Page -->
        <div id="incident-reporter-page" class="page-section min-h-screen py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-gray-50">
            <div class="max-w-7xl mx-auto">
                <!-- Header -->
                <div class="text-center mb-12">
                    <div class="inline-block px-4 py-2 bg-orange-100 text-orange-700 rounded-full mb-4 font-semibold">
                        Community Reporting
                    </div>
                    <h2 class="text-4xl sm:text-5xl text-white mb-4 font-bold">
                        Report Traffic Incidents
                    </h2>
                    <p class="text-xl text-gray-400 max-w-3xl mx-auto in">
                        Help other commuters by reporting accidents, roadwork, and hazards in real-time
                    </p>
                </div>

                <div class="grid lg:grid-cols-3 gap-6">
                    <!-- Report Form -->
                    <div class="lg:col-span-2">
                        <div id="incidentFormContainer" class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                            <form id="incidentForm" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Incident Type</label>
                                    <select id="incidentType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Select incident type</option>
                                        <option value="accident">🚗 Accident</option>
                                        <option value="roadwork">🚧 Roadwork</option>
                                        <option value="hazard">⚠️ Road Hazard</option>
                                        <option value="weather">🌧️ Weather Condition</option>
                                    </select>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                                    <div class="relative">
                                        <input type="text" id="incidentLocation" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter location or use current location" required>
                                        <i data-lucide="map-pin" class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                                    </div>
                                    <button id="useCurrentLocationBtn" type="button" class="mt-2 flex items-center gap-2 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        <i data-lucide="map-pin" class="w-4 h-4"></i>
                                        Use My Current Location
                                    </button>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description (Optional)</label>
                                    <textarea id="incidentDescription" rows="5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none" placeholder="Provide additional details about the incident..."></textarea>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Add Photo (Optional)</label>
                                    <div id="incidentDropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer">
                                        <i data-lucide="camera" class="w-8 h-8 text-gray-400 mx-auto mb-2"></i>
                                        <p class="text-gray-600">Click to upload or drag and drop</p>
                                        <p class="text-sm text-gray-500">PNG, JPG up to 10MB</p>
                                        <input id="incidentPhoto" type="file" accept="image/png, image/jpeg" class="hidden" />
                                        <div id="incidentPhotoPreview" class="mt-4 hidden">
                                            <img id="incidentPhotoImg" src="" alt="Preview" class="max-h-40 mx-auto rounded-lg border border-gray-300" />
                                            <p class="text-xs text-gray-500 mt-2">Preview</p>
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors">
                                    <i data-lucide="send" class="w-4 h-4"></i>
                                    Submit Report
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Side Panel -->
                    <div class="space-y-6">
                        <!-- Recent Reports -->
                        <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Community Reports</h3>
                            <div id="recentReportsList" class="space-y-4">
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-start gap-3 mb-2">
                                        <span class="text-2xl">🚗</span>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                                <span class="font-medium text-black">Accident</span>
                                                <span class="px-2 py-1 border border-red-200 text-red-700 text-xs rounded">high</span>
                                            </div>
                                            <p class="text-gray-600 text-sm break-words">EDSA-Shaw Boulevard</p>
                                            <div class="flex items-center gap-2 mt-2 text-sm text-gray-500">
                                                <span>5 min ago</span>
                                                <i data-lucide="check-circle-2" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-start gap-3 mb-2">
                                        <span class="text-2xl">🚧</span>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                                <span class="font-medium text-black">Roadwork</span>
                                                <span class="px-2 py-1 border border-yellow-200 text-yellow-700 text-xs rounded">medium</span>
                                            </div>
                                            <p class="text-gray-600 text-sm break-words">C5-Ortigas Avenue</p>
                                            <div class="flex items-center gap-2 mt-2 text-sm text-gray-500">
                                                <span>18 min ago</span>
                                                <i data-lucide="check-circle-2" class="w-4 h-4 text-green-600"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <div class="flex items-start gap-3 mb-2">
                                        <span class="text-2xl">⚠️</span>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center gap-2 mb-1 flex-wrap">
                                                <span class="font-medium text-black">Road Hazard</span>
                                                <span class="px-2 py-1 border border-green-200 text-green-700 text-xs rounded">low</span>
                                            </div>
                                            <p class="text-gray-600 text-sm break-words">Commonwealth Ave</p>
                                            <div class="flex items-center gap-2 mt-2 text-sm text-gray-500">
                                                <span>32 min ago</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Why Report -->
                        <div class="p-6 bg-blue-50 rounded-lg border border-blue-200">
                            <h4 class="font-semibold text-gray-900 mb-3">Why Report?</h4>
                            <ul class="space-y-2 text-gray-700">
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check-circle-2" class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"></i>
                                    <span>Help other commuters avoid delays</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check-circle-2" class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"></i>
                                    <span>Improve traffic prediction accuracy</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i data-lucide="check-circle-2" class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"></i>
                                    <span>Assist traffic authorities in response</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Console Page -->
        <div id="admin-console-page" class="page-section min-h-screen py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-gray-50">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-12">
                    <div class="inline-block px-4 py-2 bg-gray-100 text-gray-700 rounded-full mb-4 font-semibold">
                        Admin Console
                    </div>
                    <h2 class="text-4xl sm:text-5xl text-white mb-4 font-bold">
                        Operations & Monitoring
                    </h2>
                    <p class="text-xl text-gray-400 max-w-3xl mx-auto in">
                        Manage datasets, retrain models, view system health, logs, and performance
                    </p>
                 
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Dataset Uploader</h3>
                        <input id="adminDatasetFile" type="file" accept=".csv,.parquet,.json,.zip" class="w-full mb-3 px-3 py-2 border border-gray-300 rounded-lg">
                        <button id="adminUploadBtn" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium">Upload Dataset</button>
                        <div id="adminUploadStatus" class="mt-3 text-sm text-gray-600"></div>
                    </div>
                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Model Retrain</h3>
                        <button id="adminRetrainBtn" class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium">Trigger Retrain</button>
                        <div class="mt-4 w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                            <div id="adminRetrainProgress" class="h-full bg-purple-600 transition-all" style="width: 0%"></div>
                        </div>
                        <div id="adminRetrainStatus" class="mt-3 text-sm text-gray-600"></div>
                    </div>
                    <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">System Health</h3>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" id="healthCPU">--%</div>
                                <div class="text-sm text-gray-600">CPU</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" id="healthMem">--%</div>
                                <div class="text-sm text-gray-600">Memory</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-gray-900" id="healthUptime">--h</div>
                                <div class="text-sm text-gray-600">Uptime</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6">
                        <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Inference Latency</h3>
                                <span class="px-3 py-1 border border-gray-300 rounded-lg text-sm text-gray-600">ms</span>
                            </div>
                            <div class="chart-container"><canvas id="adminLatencyChart"></canvas></div>
                        </div>
                        <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Throughput</h3>
                                <span class="px-3 py-1 border border-gray-300 rounded-lg text-sm text-gray-600">req/min</span>
                            </div>
                            <div class="chart-container"><canvas id="adminThroughputChart"></canvas></div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">System Logs</h3>
                                <button id="adminAddLogBtn" class="px-3 py-1 bg-gray-900 text-white rounded-lg text-sm">Add Sample Log</button>
                            </div>
                            <div id="adminLogs" class="space-y-3 max-h-80 overflow-auto"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prediction Module Page -->
        <div id="prediction-page" class="page-section min-h-screen py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-gray-50">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-12">
                    <div class="inline-block px-4 py-2 bg-green-100 text-green-700 rounded-full mb-4 font-semibold">Prediction Module</div>
                    <h2 class="text-4xl sm:text-5xl text-white mb-4 font-bold">Request Travel-Time Prediction</h2>
                    <p class="text-xl text-gray-400 max-w-3xl mx-auto in">Predict travel time for a route or corridor with confidence intervals</p>
                </div>
                <div class="grid lg:grid-cols-3 gap-6">
                    <div class="p-6 bg-white rounded-lg border border-gray-200 lg:col-span-1">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Inputs</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                        <select id="predType" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-4">
                            <option value="route">Route (Origin → Destination)</option>
                            <option value="corridor">Corridor (e.g., EDSA)</option>
                        </select>
                        <div id="predRouteInputs">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Origin</label>
                            <input id="predOrigin" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-3" placeholder="e.g., Quezon City Hall" />
                            <label class="block text-sm font-medium text-gray-700 mb-2">Destination</label>
                            <input id="predDestination" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-3" placeholder="e.g., Makati CBD" />
                        </div>
                        <div id="predCorridorInputs" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Corridor</label>
                            <input id="predCorridor" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-3" placeholder="e.g., EDSA" />
                        </div>
                        <button id="predSubmit" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium">Predict</button>
                        <div class="mt-3 text-sm text-gray-600">Predictions are simulated; connect your API to power this.</div>
                    </div>
                    <div class="lg:col-span-2 space-y-6">
                        <div class="p-6 bg-white rounded-lg border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Result</h3>
                            <div id="predResult" class="text-gray-700">No prediction yet.</div>
                        </div>
                        <div class="p-6 bg-white rounded-lg border border-gray-200">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Confidence Intervals</h3>
                                <span class="px-3 py-1 border border-gray-300 rounded-lg text-sm text-gray-600">p50/p90/p95</span>
                            </div>
                            <div class="chart-container"><canvas id="predIntervalsChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reporting & Export Page -->
        <div id="reporting-page" class="page-section min-h-screen py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-gray-50">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-12">
                    <div class="inline-block px-4 py-2 bg-amber-100 text-amber-700 rounded-full mb-4 font-semibold">Reporting & Export</div>
                    <h2 class="text-4xl sm:text-5xl text-white mb-4 font-bold">Historical Predictions & Logs</h2>
                    <p class="text-xl text-gray-400 max-w-3xl mx-auto in">Review and export data for offline analysis</p>
                </div>
                <div class="p-6 bg-white rounded-lg border border-gray-200 mb-6">
                    <div class="flex flex-wrap gap-2">
                        <button id="exportPredJSON" class="px-4 py-2 bg-gray-900 text-white rounded-lg">Export JSON</button>
                        <button id="exportPredCSV" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Export CSV</button>
                        <button id="clearPredLogs" class="px-4 py-2 bg-red-600 text-white rounded-lg">Clear Logs</button>
                    </div>
                </div>
                <div class="p-6 bg-white rounded-lg border border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Prediction Logs</h3>
                    <div id="predLogs" class="space-y-3"></div>
                </div>
            </div>
        </div>

        <!-- Profile / Authentication Page -->
        <div id="profile-page" class="page-section min-h-screen py-24 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-white to-gray-50">
            <div class="max-w-5xl mx-auto">
                <div class="grid lg:grid-cols-2 gap-6">
                    <div class="p-6 bg-white rounded-lg border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Authentication</h3>
                        <div id="authArea">
                            <div id="authLoggedOut">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input id="authEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-3" placeholder="you@example.com" />
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input id="authPassword" type="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-4" placeholder="••••••••" />
                                <div class="flex gap-2">
                                    <button id="authLoginBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Log in</button>
                                    <button id="authSignupBtn" class="px-4 py-2 bg-gray-900 text-white rounded-lg">Sign up</button>
                                </div>
                            </div>
                            <div id="authLoggedIn" class="hidden">
                                <div class="flex items-center justify-between mb-3">
                                    <div>
                                        <div class="text-sm text-gray-500">Signed in as</div>
                                        <div id="authUserEmail" class="text-gray-900 font-medium">-</div>
                                    </div>
                                    <button id="authLogoutBtn" class="px-3 py-1 bg-red-600 text-white rounded-lg">Log out</button>
                                </div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Display Name</label>
                                <input id="authDisplayName" class="w-full px-3 py-2 border border-gray-300 rounded-lg mb-2" placeholder="Your name" />
                                <button id="authSaveProfile" class="px-4 py-2 bg-blue-600 text-white rounded-lg">Save Profile</button>
                            </div>
                        </div>
                    </div>
                    <div class="p-6 bg-white rounded-lg border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Notification Preferences</h3>
                        <div class="space-y-3">
                            <label class="flex items-center gap-2">
                                <input id="prefAlerts" type="checkbox" class="w-4 h-4">
                                <span>Traffic alerts</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input id="prefReports" type="checkbox" class="w-4 h-4">
                                <span>Community reports</span>
                            </label>
                            <label class="flex items-center gap-2">
                                <input id="prefTips" type="checkbox" class="w-4 h-4">
                                <span>Product tips</span>
                            </label>
                            <button id="savePrefsBtn" class="mt-2 px-4 py-2 bg-green-600 text-white rounded-lg">Save Preferences</button>
                            <button id="enablePushBtn" class="mt-2 px-4 py-2 bg-gray-900 text-white rounded-lg">Enable Push Notifications</button>
                        </div>
                    </div>
                </div>
                <div class="mt-6 p-6 bg-white rounded-lg border border-gray-200">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">Saved Routes</h3>
                        <button id="clearSavedRoutes" class="px-3 py-1 bg-red-600 text-white rounded-lg text-sm">Clear</button>
                    </div>
                    <div id="savedRoutesList" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-950 text-white py-16 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12">
                <!-- About -->
                <div>
                    <h3 class="text-xl font-semibold mb-4">IntelliTraffic</h3>
                    <p class="text-gray-400 mb-4">
                        A capstone project leveraging predictive analytics and machine learning 
                        for smarter urban traffic management.
                    </p>
                    <div class="flex items-center gap-2 text-gray-400">
                        <i data-lucide="calendar" class="w-4 h-4"></i>
                        <span>September 2025</span>
                    </div>
                </div>

                <!-- Features -->
                <div>
                    <h4 class="font-semibold mb-4">Features</h4>
                    <ul class="space-y-3">
                        <li>
                            <a href="#" onclick="navigateTo('traffic-map'); return false;" class="text-gray-400 hover:text-white transition-colors">
                                Traffic Map
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="navigateTo('route-planner'); return false;" class="text-gray-400 hover:text-white transition-colors">
                                Route Planner
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="navigateTo('analytics'); return false;" class="text-gray-400 hover:text-white transition-colors">
                                Analytics Dashboard
                            </a>
                        </li>
                        <li>
                            <a href="#" onclick="navigateTo('incident-reporter'); return false;" class="text-gray-400 hover:text-white transition-colors">
                                Incident Reporter
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Institution -->
                <div>
                    <h4 class="font-semibold mb-4">Institution</h4>
                    <ul class="space-y-3 text-gray-400">
                        <li>National University</li>
                        <li>College of Computing and Information Technologies</li>
                        <li>BS Information Technology</li>
                        <li>Mobile & Web Application</li>
                    </ul>
                </div>

                <!-- Contact -->
                <div>
                    <h4 class="font-semibold mb-4">Contact</h4>
                    <div class="space-y-3">
                        <a href="mailto:intellitraffic@nu.edu.ph" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
                            <i data-lucide="mail" class="w-4 h-4"></i>
                            <span>intellitraffic@nu.edu.ph</span>
                        </a>
                        <a href="#" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
                            <i data-lucide="github" class="w-4 h-4"></i>
                            <span>View on GitHub</span>
                        </a>
                        <a href="#" class="flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
                            <i data-lucide="file-text" class="w-4 h-4"></i>
                            <span>Documentation</span>
                        </a>
                    </div>
                </div>
            </div>

            <div class="h-px bg-gray-800 mb-8"></div>

            <!-- Bottom -->
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-gray-400 text-center md:text-left">
                    &copy; 2025 IntelliTraffic. A National University Capstone Project.
                </p>
                <div class="text-gray-400 text-center md:text-right">
                    <p>Alcantara &bull; Hernandez &bull; Tan &bull; Viray</p>
                    <p class="text-sm">Adviser: Irene Balmes</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Toast notifications root -->
    <div id="toastRoot" class="fixed bottom-4 right-4 z-[100] space-y-2 pointer-events-none"></div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Current page state
        let currentPage = 'home';

        // Always start at top on refresh/navigation: disable browser scroll restoration
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }

        // Toast helper (iziToast)
        function showToast(message, type = 'success') {
            if (typeof iziToast === 'undefined') return;
            const common = { message, position: 'bottomRight', timeout: 3000, close: true, progressBar: true }; 
            if (type === 'success') {
                iziToast.success({ title: 'Success', ...common });
            } else if (type === 'error') {
                iziToast.error({ title: 'Error', ...common });
            } else {
                iziToast.info({ title: 'Notice', ...common });
            }
        }

        // Navigation function
        function navigateTo(page) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected page
            const targetSection = document.getElementById(`${page}-page`);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            currentPage = page;
            try { localStorage.setItem('currentPage', page); } catch {}
            
            // Update active nav buttons
            updateNavButtons(page);
            
            // Close mobile menu
            document.getElementById('mobileMenu').classList.remove('active');
            
            // Close More dropdown if open
            try { const dd = document.getElementById('moreDropdown'); if (dd) dd.classList.add('hidden'); } catch {}
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Page-specific initializations
            if (page === 'traffic-map') {
                initLeafletMap();
            } else if (page === 'analytics') {
                initCharts();
            } else if (page === 'route-planner') {
                initRoutePlannerMap();
                // Ensure blank fields for planning a new route
                const o = document.getElementById('routeOrigin');
                const d = document.getElementById('routeDestination');
                if (o) o.value = '';
                if (d) d.value = '';
            } else if (page === 'incident-reporter') {
                if (typeof renderRecentReports === 'function') renderRecentReports();
            } else if (page === 'admin-console') {
                if (typeof initAdminConsole === 'function') initAdminConsole();
            } else if (page === 'prediction') {
                if (typeof initPrediction === 'function') initPrediction();
            } else if (page === 'reporting') {
                if (typeof initReporting === 'function') initReporting();
            } else if (page === 'profile') {
                if (typeof initProfile === 'function') initProfile();
            }
            
            // Re-trigger fade-up animations for the new page
            if (window.__revealPage) {
                window.__revealPage('#' + page + '-page');
            }
        }

        // Update navigation button states
        function updateNavButtons(page) {
            // Desktop nav
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if (btn.dataset.page === page) {
                    btn.classList.add('bg-blue-600', 'text-white');
                    btn.classList.remove('text-gray-700', 'hover:bg-gray-100');
                } else {
                    btn.classList.remove('bg-blue-600', 'text-white');
                    btn.classList.add('text-gray-700', 'hover:bg-gray-100');
                }
            });

            // Mobile nav
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
                if (btn.dataset.page === page) {
                    btn.classList.add('bg-blue-600', 'text-white');
                    btn.classList.remove('text-gray-700', 'hover:bg-gray-100');
                } else {
                    btn.classList.remove('bg-blue-600', 'text-white');
                    btn.classList.add('text-gray-700', 'hover:bg-gray-100');
                }
            });
        }

        // Toggle mobile menu
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('active');
        }

        // Scroll to features
        function scrollToFeatures() {
            const features = document.getElementById('features');
            if (features) {
                features.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Traffic Map functionality
        const trafficPoints = [
            { id: 1, location: "EDSA-Shaw Blvd", severity: "high", delay: "25 min", x: 30, y: 40 },
            { id: 2, location: "C5-Ortigas Ave", severity: "medium", delay: "12 min", x: 60, y: 35 },
            { id: 3, location: "Quezon Ave-EDSA", severity: "low", delay: "5 min", x: 40, y: 25 },
            { id: 4, location: "España-Lacson", severity: "high", delay: "30 min", x: 45, y: 50 },
            { id: 5, location: "Roxas Blvd", severity: "medium", delay: "15 min", x: 25, y: 70 },
        ];

        function getSeverityColor(severity) {
            switch (severity) {
                case "high": return "bg-red-500";
                case "medium": return "bg-yellow-500";
                case "low": return "bg-green-500";
                default: return "bg-gray-500";
            }
        }

        // Live map using Leaflet
        let __leaflet = { map: null, markersLayer: null, currentView: 'current' };

        const sampleLatLngPoints = [
            { id: 1, location: "EDSA-Shaw Blvd", severity: "high", delay: "25 min", lat: 14.5817, lng: 121.0547 },
            { id: 2, location: "C5-Ortigas Ave", severity: "medium", delay: "12 min", lat: 14.5885, lng: 121.0658 },
            { id: 3, location: "Quezon Ave-EDSA", severity: "low", delay: "5 min", lat: 14.6393, lng: 121.0362 },
            { id: 4, location: "España-Lacson", severity: "high", delay: "30 min", lat: 14.6107, lng: 120.9906 },
            { id: 5, location: "Roxas Blvd", severity: "medium", delay: "15 min", lat: 14.5534, lng: 120.9842 },
        ];

        function initLeafletMap() {
            const mapEl = document.getElementById('leafletMap');
            if (!mapEl) return;

            // If already initialized, just ensure proper sizing and refresh markers
            if (__leaflet.map) {
                setTimeout(() => __leaflet.map.invalidateSize(), 50);
                renderLeafletMarkers(__leaflet.currentView);
                return;
            }

            __leaflet.map = L.map('leafletMap', { zoomControl: false, scrollWheelZoom: false, keyboard: false, tap: false }).setView([14.5995, 120.9842], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(__leaflet.map);
            L.control.zoom({ position: 'bottomright' }).addTo(__leaflet.map);

            __leaflet.markersLayer = L.layerGroup().addTo(__leaflet.map);
            renderLeafletMarkers('current');

            // Fix layout when first shown after navigation
            setTimeout(() => __leaflet.map.invalidateSize(), 200);
        }

        function markerColor(severity) {
            return severity === 'high' ? '#ef4444' : severity === 'medium' ? '#f59e0b' : '#22c55e';
        }

        function renderLeafletMarkers(view) {
            __leaflet.currentView = view || 'current';
            if (!__leaflet.map || !__leaflet.markersLayer) return;
            __leaflet.markersLayer.clearLayers();

            sampleLatLngPoints.forEach(p => {
                const circle = L.circleMarker([p.lat, p.lng], {
                    radius: 8,
                    color: markerColor(p.severity),
                    weight: 2,
                    fillColor: markerColor(p.severity),
                    fillOpacity: __leaflet.currentView === 'predicted' ? 0.4 : 0.7,
                });
                circle.bindPopup(`
                    <strong>${p.location}</strong><br/>
                    Severity: ${p.severity.toUpperCase()}<br/>
                    Expected delay: ${p.delay}
                `);
                circle.addTo(__leaflet.markersLayer);
            });
        }

        function showTrafficInfo(point) {
            alert(`Location: ${point.location}\nExpected delay: ${point.delay}\nSeverity: ${point.severity.toUpperCase()}`);
        }

        function toggleMapView(view) {
            const currentBtn = document.getElementById('currentViewBtn');
            const predictedBtn = document.getElementById('predictedViewBtn');

            if (view === 'current') {
                currentBtn.classList.add('bg-blue-600', 'text-white');
                currentBtn.classList.remove('bg-gray-200', 'text-gray-700');
                predictedBtn.classList.remove('bg-blue-600', 'text-white');
                predictedBtn.classList.add('bg-gray-200', 'text-gray-700');
            } else {
                predictedBtn.classList.add('bg-blue-600', 'text-white');
                predictedBtn.classList.remove('bg-gray-200', 'text-gray-700');
                currentBtn.classList.remove('bg-blue-600', 'text-white');
                currentBtn.classList.add('bg-gray-200', 'text-gray-700');
            }

            // Update Leaflet markers opacity/state based on view
            if (typeof renderLeafletMarkers === 'function') {
                renderLeafletMarkers(view);
            }
        }

        // Route Planner: map, geocoding, routing (Nominatim + OSRM)
        let __route = { map: null, layer: null, markers: [], routeGraphic: null };
        function initRoutePlannerMap() {
            const el = document.getElementById('routeMap');
            if (!el) return;
            if (!__route.map) {
                __route.map = L.map('routeMap', { zoomControl: false, scrollWheelZoom: false, keyboard: false, tap: false }).setView([14.5995, 120.9842], 12);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap contributors' }).addTo(__route.map);
                __route.layer = L.geoJSON(null, { style: { color: '#3b82f6', weight: 5, opacity: 0.9 } }).addTo(__route.map);
                L.control.zoom({ position: 'bottomright' }).addTo(__route.map);
            }
            setTimeout(() => __route.map.invalidateSize(), 100);
        }

        function normalizePlaceQuery(q) {
            const src = q.trim();
            const variants = new Set();
            if (src) variants.add(src);
            // Common acronyms and shorthands
            let v = src
                .replace(/\bNU\b/gi, 'National University')
                .replace(/\bQC\b/gi, 'Quezon City')
                .replace(/\bCBD\b/gi, 'Central Business District');
            if (v !== src) variants.add(v);
            // Add city/country bias if missing
            const ensurePH = (s) => /\bphilippines\b/i.test(s) ? s : `${s}, Philippines`;
            Array.from(variants).forEach(item => variants.add(ensurePH(item)));
            // Specific helpful hints
            if (/\blipa\b/i.test(src)) {
                variants.add('National University Lipa, Philippines');
                variants.add('National University Lipa Campus, Philippines');
            }
            return Array.from(variants);
        }

        function haversineDistanceKm(a, b) {
            const R = 6371; // km
            const toRad = (deg) => deg * Math.PI / 180;
            const dLat = toRad(b.lat - a.lat);
            const dLon = toRad(b.lon - a.lon);
            const lat1 = toRad(a.lat);
            const lat2 = toRad(b.lat);
            const h = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
            return 2 * R * Math.asin(Math.sqrt(h));
        }

        async function geocodePlace(q) {
            const candidates = normalizePlaceQuery(q);
            let lastErr = null;
            for (const cand of candidates) {
                try {
                    const url = `https://nominatim.openstreetmap.org/search?format=jsonv2&limit=1&countrycodes=ph&accept-language=en&q=${encodeURIComponent(cand)}`;
                    const resp = await fetch(url);
                    if (!resp.ok) { lastErr = new Error('Geocoding failed'); continue; }
                    const data = await resp.json();
                    if (data && data.length) {
                        const { lat, lon, display_name } = data[0];
                        return { lat: parseFloat(lat), lon: parseFloat(lon), name: display_name };
                    }
                } catch (e) {
                    lastErr = e;
                }
            }
            throw lastErr || new Error('Location not found');
        }

        async function routeOSRM(start, end) {
            // start/end: {lat, lon}
            const url = `https://router.project-osrm.org/route/v1/driving/${start.lon},${start.lat};${end.lon},${end.lat}?overview=full&geometries=geojson&steps=true`;
            const resp = await fetch(url);
            if (!resp.ok) throw new Error('Routing failed');
            const data = await resp.json();
            if (!data.routes || !data.routes.length) throw new Error('No route found');
            return data.routes[0];
        }

        function routeHasFerry(route) {
            try {
                if (!route || !route.legs) return false;
                return route.legs.some((leg) => Array.isArray(leg.steps) && leg.steps.some((s) => {
                    const name = (s.name || '').toLowerCase();
                    const mode = (s.mode || '').toLowerCase();
                    return mode === 'ferry' || name.includes('ferry');
                }));
            } catch { return false; }
        }

        function clearRoute() {
            if (__route.layer) __route.layer.clearLayers();
            if (__route.routeGraphic) { try { __route.routeGraphic.remove(); } catch {} __route.routeGraphic = null; }
            __route.markers.forEach(m => m.remove());
            __route.markers = [];
        }

        function fitRouteBounds(obj) {
            if (!__route.map || !obj) return;
            // If we received Leaflet LatLngBounds, fit directly
            if (typeof obj.getSouthWest === 'function' && typeof obj.getNorthEast === 'function') {
                const b = obj;
                if (b.isValid && b.isValid()) {
                    __route.map.fitBounds(b, { padding: [24, 24] });
                } else {
                    __route.map.fitBounds(b, { padding: [24, 24] });
                }
                return;
            }
            // Otherwise assume GeoJSON geometry/feature(s)
            try {
                const layer = L.geoJSON(obj);
                const b = layer.getBounds();
                if (b && b.isValid()) {
                    __route.map.fitBounds(b, { padding: [24, 24] });
                }
            } catch (_) {
                // No-op on invalid input
            }
        }

        async function showRouteResults() {
            try {
                initRoutePlannerMap();
                const originText = document.getElementById('routeOrigin').value.trim();
                const destText = document.getElementById('routeDestination').value.trim();
                const departSel = document.getElementById('routeDepartureTime').value;
                const customTimeEl = document.getElementById('routeCustomTime');
                const customTime = !customTimeEl.classList.contains('hidden') ? customTimeEl.value : '';
                let mode = (document.getElementById('routeMode')?.value) || 'driving';
                if (!originText || !destText) { showToast('Please enter both origin and destination.', 'error'); return; }

                const container = document.getElementById('routeResults');
                container.innerHTML = '<div class="p-6 bg-gray-800 rounded-lg border border-gray-700 text-gray-300">Calculating route...</div>';

                const [start, end] = await Promise.all([geocodePlace(originText), geocodePlace(destText)]);
                let km = 0;
                let mins = 0;
                let effectiveMode = mode; // track final used/recommended mode
                clearRoute();

                // Guard: prevent Ferry/Flight for short land-only trips
                if ((mode === 'ferry' || mode === 'flight')) {
                    const straightKmGuard = haversineDistanceKm(start, end);
                    let drivingOK = false;
                    try {
                        const drv = await routeOSRM(start, end);
                        const drivenKmGuard = drv.distance / 1000;
                        const ratioGuard = drivenKmGuard / Math.max(straightKmGuard, 1);
                        const hasFerry = routeHasFerry(drv);
                        drivingOK = !hasFerry && (ratioGuard <= 1.9); // reasonable land detour and no ferry
                    } catch {}
                    if ((straightKmGuard < 60 && drivingOK) || straightKmGuard < 30) {
                        showToast('Ferry/Flight not allowed: short land-only trip detected. Using Driving instead.', 'error');
                        mode = 'driving';
                        effectiveMode = 'driving';
                    }
                }

                if (mode === 'driving') {
                    const straightKmDrive = haversineDistanceKm(start, end);
                    try {
                        const route = await routeOSRM(start, end);
                        const drivenKm = route.distance / 1000;
                        const ratio = drivenKm / Math.max(straightKmDrive, 1);
                        const hasFerry = routeHasFerry(route);
                        // If this looks like a water crossing, do not allow Driving
                        if (hasFerry || straightKmDrive > 250 || (straightKmDrive > 100 && ratio > 1.7) || (straightKmDrive > 60 && ratio > 1.9) || ratio > 2.6) {
                            const picked = straightKmDrive > 250 ? 'flight' : 'ferry';
                            showToast(`Driving not allowed: water crossing detected. Switching to ${picked}.`, 'error');
                            const color = picked === 'ferry' ? '#0ea5e9' : '#f97316';
                            const line = L.polyline([[start.lat, start.lon], [end.lat, end.lon]], { color, weight: 5, opacity: .9 });
                            line.addTo(__route.map); __route.routeGraphic = line;
                            __route.markers.push(L.marker([start.lat, start.lon]));
                            __route.markers.push(L.marker([end.lat, end.lon]));
                            __route.markers.forEach(m => m.addTo(__route.map));
                            __route.layer.clearLayers();
                            fitRouteBounds(line.getBounds());
                            km = straightKmDrive;
                            if (picked === 'ferry') { const speed = 35; const overheadMin = 30; mins = Math.round((km / speed) * 60 + overheadMin); }
                            else { const speed = 600; const overheadMin = 120; mins = Math.round((km / speed) * 60 + overheadMin); }
                            effectiveMode = picked;
                        } else {
                            // Safe to use Driving
                            __route.layer.addData(route.geometry);
                            __route.markers.push(L.marker([start.lat, start.lon]));
                            __route.markers.push(L.marker([end.lat, end.lon]));
                            __route.markers.forEach(m => m.addTo(__route.map));
                            fitRouteBounds(route.geometry);
                            km = (route.distance / 1000);
                            mins = Math.round(route.duration / 60);
                            effectiveMode = 'driving';
                        }
                    } catch {
                        // If OSRM fails, choose based on straight distance
                        const picked = straightKmDrive > 250 ? 'flight' : 'ferry';
                        showToast(`Driving not available for this route. Switching to ${picked}.`, 'error');
                        const color = picked === 'ferry' ? '#0ea5e9' : '#f97316';
                        const line = L.polyline([[start.lat, start.lon], [end.lat, end.lon]], { color, weight: 5, opacity: .9 });
                        line.addTo(__route.map); __route.routeGraphic = line;
                        __route.markers.push(L.marker([start.lat, start.lon]));
                        __route.markers.push(L.marker([end.lat, end.lon]));
                        __route.markers.forEach(m => m.addTo(__route.map));
                        __route.layer.clearLayers();
                        fitRouteBounds(line.getBounds());
                        km = straightKmDrive;
                        if (picked === 'ferry') { const speed = 35; const overheadMin = 30; mins = Math.round((km / speed) * 60 + overheadMin); }
                        else { const speed = 600; const overheadMin = 120; mins = Math.round((km / speed) * 60 + overheadMin); }
                        effectiveMode = picked;
                    }
                } else if (mode === 'ferry' || mode === 'flight') {
                    // Draw straight polyline as an estimate
                    const color = mode === 'ferry' ? '#0ea5e9' : '#f97316';
                    const line = L.polyline([[start.lat, start.lon], [end.lat, end.lon]], { color, weight: 5, opacity: .9 });
                    line.addTo(__route.map); __route.routeGraphic = line;
                    __route.markers.push(L.marker([start.lat, start.lon]));
                    __route.markers.push(L.marker([end.lat, end.lon]));
                    __route.markers.forEach(m => m.addTo(__route.map));
                    __route.layer.clearLayers();
                    fitRouteBounds(line.getBounds());
                    km = haversineDistanceKm(start, end);
                    // Simple estimates: include overheads
                    if (mode === 'ferry') {
                        const speed = 35; // km/h average
                        const overheadMin = 30; // boarding, docking
                        mins = Math.round((km / speed) * 60 + overheadMin); effectiveMode = 'ferry';
                    } else { // flight
                        const speed = 600; // km/h average
                        const overheadMin = 120; // check-in, security, taxiing
                        mins = Math.round((km / speed) * 60 + overheadMin); effectiveMode = 'flight';
                    }
                } else if (mode === 'transit') {
                    showToast('Public transit requires an external API (e.g., Google Directions). I can wire it with your API key.', 'error');
                    // Fallback to driving if transit unavailable
                    const route = await routeOSRM(start, end);
                    __route.layer.addData(route.geometry);
                    __route.markers.push(L.marker([start.lat, start.lon]));
                    __route.markers.push(L.marker([end.lat, end.lon]));
                    __route.markers.forEach(m => m.addTo(__route.map));
                    fitRouteBounds(route.geometry);
                    km = (route.distance / 1000);
                    mins = Math.round(route.duration / 60);
                    effectiveMode = 'driving';
                }

                container.innerHTML = '';
                const header = document.createElement('div');
                header.className = 'flex items-center justify-between mb-4';
                const modeColor = effectiveMode === 'ferry' ? 'bg-cyan-600' : (effectiveMode === 'flight' ? 'bg-orange-600' : 'bg-blue-600');
                const modeLabel = effectiveMode ? effectiveMode.charAt(0).toUpperCase() + effectiveMode.slice(1) : 'Driving';
                header.innerHTML = `
                    <h3 class="text-xl font-semibold text-white">Best Route</h3>
                    <div class="flex items-center gap-2">
                        <span class="px-3 py-1 ${modeColor} text-white rounded-lg text-sm font-medium">Mode: ${modeLabel}</span>
                        <span class="px-3 py-1 bg-gray-700 text-white rounded-lg text-sm font-medium">${departSel === 'custom' ? (customTime || 'Custom') : departSel}</span>
                    </div>
                `;
                container.appendChild(header);

                const card = document.createElement('div');
                card.className = 'p-6 bg-gray-800 rounded-lg border border-gray-700';
                card.innerHTML = `
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-2">
                        <div>
                            <div class="text-sm text-gray-400 mb-1">Distance</div>
                            <div class="text-white font-semibold">${km.toFixed(1)} km</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-400 mb-1">Duration</div>
                            <div class="text-white font-semibold">${mins} min</div>
                        </div>
                        <div class="md:col-span-2">
                            <div class="text-sm text-gray-400 mb-1">From → To</div>
                            <div class="text-gray-300 break-words whitespace-normal">${start.name} → ${end.name}</div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span>Powered by OpenStreetMap & OSRM</span>
                        <span class="px-2 py-0.5 border border-gray-600 rounded">Mode: ${mode}</span>
                    </div>
                `;
                container.appendChild(card);
                // Save route button if logged in
                try {
                    if (typeof getAuth === 'function' && getAuth()) {
                        const saveBtn = document.createElement('button');
                        saveBtn.className = 'mt-3 px-3 py-2 bg-green-600 text-white rounded';
                        saveBtn.textContent = 'Save this route';
                        saveBtn.addEventListener('click', () => {
                            const u = getAuth(); if (!u) { showToast('Please log in', 'error'); return; }
                            const label = `${start.name.split(',')[0]} → ${end.name.split(',')[0]}`;
                            (u.savedRoutes = u.savedRoutes || []).unshift({ from: start.name, to: end.name, km, mins, label });
                            u.savedRoutes = u.savedRoutes.slice(0, 50);
                            setAuth(u);
                            showToast('Route saved');
                        });
                        const alertsBtn = document.createElement('button');
                        alertsBtn.className = 'mt-3 ml-2 px-3 py-2 bg-yellow-500 text-black rounded';
                        alertsBtn.textContent = 'Subscribe to alerts';
                        alertsBtn.addEventListener('click', () => {
                            const uNow = getAuth(); if (!uNow) { showToast('Please log in', 'error'); return; }
                            const labelNow = `${start.name.split(',')[0]} → ${end.name.split(',')[0]}`;
                            subscribe(labelNow);
                            showToast('Subscribed to route alerts');
                        });
                        const group = document.createElement('div');
                        group.appendChild(saveBtn);
                        group.appendChild(alertsBtn);
                        container.appendChild(group);
                    }
                } catch {}
                lucide.createIcons();
            } catch (e) {
                showToast(e.message || 'Unable to compute route.', 'error');
            }
        }

        // Initialize Charts
        function initCharts() {
            // Traffic Flow Chart
            const trafficFlowCtx = document.getElementById('trafficFlowChart');
            if (trafficFlowCtx && !trafficFlowCtx.chart) {
                trafficFlowCtx.chart = new Chart(trafficFlowCtx, {
                    type: 'line',
                    data: {
                        labels: ['6 AM', '7 AM', '8 AM', '9 AM', '10 AM', '11 AM', '12 PM'],
                        datasets: [
                            {
                                label: 'Actual Traffic',
                                data: [45, 72, 88, 95, 68, 55, 62],
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4
                            },
                            {
                                label: 'AI Prediction',
                                data: [42, 75, 85, 92, 70, 58, 60],
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                borderDash: [5, 5],
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }

            // Weekly Trends Chart
            const weeklyTrendsCtx = document.getElementById('weeklyTrendsChart');
            if (weeklyTrendsCtx && !weeklyTrendsCtx.chart) {
                weeklyTrendsCtx.chart = new Chart(weeklyTrendsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Congestion %',
                            data: [75, 80, 82, 78, 92, 45, 35],
                            backgroundColor: '#3b82f6',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
        }

        // ===== Auth & Profile =====
        function getAuth() { try { return JSON.parse(localStorage.getItem('authUser')||'null'); } catch { return null; } }
        function setAuth(u) { if (u) localStorage.setItem('authUser', JSON.stringify(u)); else localStorage.removeItem('authUser'); }
        function renderSavedRoutes() {
            const list = document.getElementById('savedRoutesList'); if (!list) return;
            const u = getAuth(); const items = (u && u.savedRoutes) ? u.savedRoutes : [];
            list.innerHTML = items.length ? items.map((r,i)=>`<div class="p-3 border rounded flex items-center justify-between"><div><div class="font-medium text-gray-900">${r.label||('Route '+(i+1))}</div><div class="text-sm text-gray-600">${r.from} → ${r.to} • ${r.km?.toFixed? r.km.toFixed(1):r.km} km • ${r.mins} min</div></div><button data-i="${i}" class="px-3 py-1 bg-red-600 text-white rounded text-sm rmRoute">Remove</button></div>`).join('') : '<div class="text-gray-500">No saved routes.</div>';
            list.querySelectorAll('.rmRoute').forEach(btn=>{ btn.addEventListener('click', () => { const idx = +btn.getAttribute('data-i'); const u2 = getAuth(); if (!u2) return; u2.savedRoutes.splice(idx,1); setAuth(u2); renderSavedRoutes(); }); });
            // Append Subscribe/Unsubscribe toggle per saved route
            try {
                const uCur = getAuth(); const subs = (uCur && Array.isArray(uCur.subscriptions)) ? uCur.subscriptions : [];
                const rows = list.querySelectorAll('.p-3.border.rounded');
                rows.forEach((row, idx) => {
                    const item = items[idx]; if (!item) return;
                    const label = item.label || `${item.from} → ${item.to}`;
                    const isSub = subs.includes(label);
                    const btn = document.createElement('button');
                    btn.className = 'ml-2 px-3 py-1 rounded text-sm ' + (isSub ? 'bg-yellow-500 text-black' : 'bg-blue-600 text-white');
                    btn.textContent = isSub ? 'Unsubscribe' : 'Subscribe';
                    btn.addEventListener('click', () => {
                        const u3 = getAuth(); if (!u3) { showToast('Please log in', 'error'); return; }
                        u3.subscriptions = Array.isArray(u3.subscriptions) ? u3.subscriptions : [];
                        const pos = u3.subscriptions.indexOf(label);
                        if (pos >= 0) { u3.subscriptions.splice(pos,1); showToast('Unsubscribed'); }
                        else { u3.subscriptions.unshift(label); showToast('Subscribed'); }
                        setAuth(u3); renderSavedRoutes();
                    });
                    const right = row.querySelector('button.rmRoute');
                    if (right && right.parentElement) right.parentElement.appendChild(btn);
                });
            } catch {}
        }
        function initProfile() {
            const user = getAuth();
            const out = document.getElementById('authLoggedOut');
            const inn = document.getElementById('authLoggedIn');
            if (user) {
                if (out) out.classList.add('hidden');
                if (inn) inn.classList.remove('hidden');
                const em = document.getElementById('authUserEmail'); if (em) em.textContent = user.email||'';
                const dn = document.getElementById('authDisplayName'); if (dn) dn.value = user.name||'';
                // prefs
                const alerts = document.getElementById('prefAlerts'); if (alerts) alerts.checked = !!(user.prefs&&user.prefs.alerts);
                const reports = document.getElementById('prefReports'); if (reports) reports.checked = !!(user.prefs&&user.prefs.reports);
                const tips = document.getElementById('prefTips'); if (tips) tips.checked = !!(user.prefs&&user.prefs.tips);
            } else {
                if (out) out.classList.remove('hidden');
                if (inn) inn.classList.add('hidden');
            }
            const login = document.getElementById('authLoginBtn');
            const signup = document.getElementById('authSignupBtn');
            const logout = document.getElementById('authLogoutBtn');
            const saveP = document.getElementById('authSaveProfile');
            const savePrefs = document.getElementById('savePrefsBtn');
            const clearSaved = document.getElementById('clearSavedRoutes');
            if (login) login.onclick = () => {
                const email = document.getElementById('authEmail').value.trim(); const pw = document.getElementById('authPassword').value;
                if (!email || !pw) { showToast('Enter email and password', 'error'); return; }
                setAuth({ email, name: '', savedRoutes: [], prefs: { alerts:true, reports:true, tips:false } });
                showToast('Logged in'); initProfile();
            };
            if (signup) signup.onclick = () => {
                const email = document.getElementById('authEmail').value.trim(); const pw = document.getElementById('authPassword').value;
                if (!email || !pw) { showToast('Enter email and password', 'error'); return; }
                setAuth({ email, name: '', savedRoutes: [], prefs: { alerts:true, reports:true, tips:false } });
                showToast('Account created'); initProfile();
            };
            if (logout) logout.onclick = () => { setAuth(null); showToast('Logged out'); initProfile(); };
            if (saveP) saveP.onclick = () => { const u = getAuth()||{}; u.name = document.getElementById('authDisplayName').value; setAuth(u); showToast('Profile saved'); initProfile(); };
            if (savePrefs) savePrefs.onclick = () => { const u = getAuth()||{}; u.prefs = { alerts: document.getElementById('prefAlerts').checked, reports: document.getElementById('prefReports').checked, tips: document.getElementById('prefTips').checked }; setAuth(u); showToast('Preferences saved'); };
            if (clearSaved) clearSaved.onclick = () => { const u = getAuth()||{}; u.savedRoutes = []; setAuth(u); renderSavedRoutes(); showToast('Saved routes cleared'); };
            const enablePush = document.getElementById('enablePushBtn');
            if (enablePush) enablePush.onclick = async () => { try { await registerPush(); showToast('Push enabled'); } catch { showToast('Push not enabled', 'error'); } };
            renderSavedRoutes();
        }

        // ===== Prediction & Reporting =====
        function loadPredLogs() { try { return JSON.parse(localStorage.getItem('predictionLogs')||'[]'); } catch { return []; } }
        function savePredLogs(list) { localStorage.setItem('predictionLogs', JSON.stringify(list.slice(0,200))); }
        function renderPredLogs() {
            const el = document.getElementById('predLogs'); if (!el) return;
            const items = loadPredLogs();
            el.innerHTML = items.length ? items.map(it => `<div class="p-3 border rounded"><div class="text-sm text-gray-500">${new Date(it.time).toLocaleString()}</div><div class="text-gray-800">${it.type==='route' ? `${it.from} → ${it.to}` : it.corridor}</div><div class="text-sm text-gray-600">p50: ${it.p50} min • p90: ${it.p90} min • p95: ${it.p95} min${it.km? ` • ${Number(it.km).toFixed(1)} km` : ''}</div></div>`).join('') : '<div class="text-gray-500">No logs yet.</div>';
        }
        function predLogsToCSV(items) {
            if (!items || !items.length) return 'time,type,from,to,corridor,km,p50,p90,p95\n';
            const header = ['time','type','from','to','corridor','km','p50','p90','p95'];
            const rows = items.map(it => header.map(k => (k==='time')? new Date(it[k]||it.time).toISOString() : (it[k]!==undefined? it[k] : '')).join(','));
            return header.join(',')+'\n'+rows.join('\n');
        }
        function downloadFile(filename, blob) { const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(a.href), 1000); }
        
        // ===== Alerts & Notifications =====
        function getSubscriptions() { const u = getAuth(); return (u && Array.isArray(u.subscriptions)) ? u.subscriptions : []; }
        function setSubscriptions(list) { const u = getAuth()||{}; u.subscriptions = list; setAuth(u); }
        function isSubscribed(label) { return getSubscriptions().includes(label); }
        function subscribe(label) { const s = getSubscriptions(); if (!s.includes(label)) { s.unshift(label); setSubscriptions(s); } }
        function unsubscribe(label) { const s = getSubscriptions().filter(x => x !== label); setSubscriptions(s); }
        function notifyInApp(title, message) { try { iziToast.show({ title, message, position: 'topRight', timeout: 6000, color: 'blue' }); } catch {} }
        async function notifyPush(title, message) {
            try {
                if (Notification.permission === 'granted' && navigator.serviceWorker?.ready) {
                    const reg = await navigator.serviceWorker.ready;
                    reg.showNotification(title, { body: message, icon: 'images/logo1.png', badge: 'images/logo1.png' });
                }
            } catch {}
        }
        async function registerPush() {
            if (!('Notification' in window)) throw new Error('No Notification API');
            if (Notification.permission !== 'granted') {
                const perm = await Notification.requestPermission();
                if (perm !== 'granted') throw new Error('Denied');
            }
            if ('serviceWorker' in navigator) { await navigator.serviceWorker.register('sw.js'); }
        }
        // Demo background simulator for alerts
        (function alertSimulator(){
            setInterval(() => {
                const subs = getSubscriptions();
                if (!subs.length) return;
                if (Math.random() < 0.166) {
                    const route = subs[Math.floor(Math.random()*subs.length)];
                    const msgs = ['Heavy traffic ahead','Accident reported','Roadwork delay','Flooded street','Lane closure','Event congestion'];
                    const msg = msgs[Math.floor(Math.random()*msgs.length)];
                    notifyInApp(`Alert: ${route}`, msg);
                    notifyPush(`Alert: ${route}`, msg);
                }
            }, 45000);
        })();
        function initPrediction() {
            const typeSel = document.getElementById('predType');
            const routeWrap = document.getElementById('predRouteInputs');
            const corWrap = document.getElementById('predCorridorInputs');
            if (typeSel) typeSel.onchange = () => { if (typeSel.value === 'route') { routeWrap.classList.remove('hidden'); corWrap.classList.add('hidden'); } else { routeWrap.classList.add('hidden'); corWrap.classList.remove('hidden'); } };
            const btn = document.getElementById('predSubmit'); const out = document.getElementById('predResult');
            if (btn) btn.onclick = async () => {
                try {
                    if (typeSel.value === 'route') {
                        const o = document.getElementById('predOrigin').value.trim();
                        const d = document.getElementById('predDestination').value.trim();
                        if (!o || !d) { showToast('Enter origin and destination', 'error'); return; }
                        const [start, end] = await Promise.all([geocodePlace(o), geocodePlace(d)]);
                        const route = await routeOSRM(start, end).catch(()=>null);
                        let km, mins; if (route) { km = (route.distance/1000); mins = Math.round(route.duration/60); } else { km = haversineDistanceKm({lat:start.lat, lon:start.lon}, {lat:end.lat, lon:end.lon}); mins = Math.round(km/35*60); }
                        const base = mins; const p50 = base; const p90 = Math.round(base*1.25); const p95 = Math.round(base*1.4);
                        out.innerHTML = `<div class="text-gray-900 text-xl font-semibold mb-2">${base} minutes (p50)</div><div class="text-gray-600">Distance: ${km.toFixed(1)} km</div><div class="mt-2 text-sm text-gray-500">p90: ${p90} min • p95: ${p95} min</div><button id="logPredBtn" class="mt-3 px-3 py-2 bg-gray-900 text-white rounded">Log Prediction</button>`;
                        const ctx = document.getElementById('predIntervalsChart'); if (ctx) { if (ctx.chart) ctx.chart.destroy(); ctx.chart = new Chart(ctx, { type: 'bar', data: { labels: ['p50','p90','p95'], datasets: [{ data: [p50,p90,p95], backgroundColor: ['#22c55e','#f59e0b','#ef4444'], borderRadius: 8 }] }, options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } } }); }
                        const btnLog = document.getElementById('logPredBtn'); if (btnLog) btnLog.onclick = () => { const logs = loadPredLogs(); logs.unshift({ time: Date.now(), type: 'route', from: o, to: d, km, p50, p90, p95 }); savePredLogs(logs); showToast('Prediction logged'); };
                    } else {
                        const corridor = document.getElementById('predCorridor').value.trim(); if (!corridor) { showToast('Enter a corridor', 'error'); return; }
                        const base = Math.round(20+Math.random()*30); const p50 = base, p90 = Math.round(base*1.2), p95 = Math.round(base*1.35);
                        out.innerHTML = `<div class=\"text-gray-900 text-xl font-semibold mb-2\">${base} minutes (p50)</div><div class=\"text-gray-600\">Corridor: ${corridor}</div><div class=\"mt-2 text-sm text-gray-500\">p90: ${p90} min • p95: ${p95} min</div><button id=\"logPredBtn\" class=\"mt-3 px-3 py-2 bg-gray-900 text-white rounded\">Log Prediction</button>`;
                        const ctx = document.getElementById('predIntervalsChart'); if (ctx) { if (ctx.chart) ctx.chart.destroy(); ctx.chart = new Chart(ctx, { type: 'bar', data: { labels: ['p50','p90','p95'], datasets: [{ data: [p50,p90,p95], backgroundColor: ['#22c55e','#f59e0b','#ef4444'], borderRadius: 8 }] }, options: { responsive:true, maintainAspectRatio:false, plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } } }); }
                        const btnLog = document.getElementById('logPredBtn'); if (btnLog) btnLog.onclick = () => { const logs = loadPredLogs(); logs.unshift({ time: Date.now(), type: 'corridor', corridor, p50, p90, p95 }); savePredLogs(logs); showToast('Prediction logged'); };
                    }
                } catch (e) { showToast('Prediction failed', 'error'); }
            };
        }
        function initReporting() {
            renderPredLogs();
            const j = document.getElementById('exportPredJSON'); if (j) j.onclick = () => { const data = loadPredLogs(); downloadFile('prediction-logs.json', new Blob([JSON.stringify(data,null,2)], {type:'application/json'})); };
            const c = document.getElementById('exportPredCSV'); if (c) c.onclick = () => { const data = loadPredLogs(); const csv = predLogsToCSV(data); downloadFile('prediction-logs.csv', new Blob([csv], {type:'text/csv'})); };
            const clr = document.getElementById('clearPredLogs'); if (clr) clr.onclick = () => { savePredLogs([]); renderPredLogs(); showToast('Logs cleared'); };
        }

        // ===== Admin Console =====
        function initAdminConsole() {
            try { lucide.createIcons(); } catch {}
            const upBtn = document.getElementById('adminUploadBtn');
            const upFile = document.getElementById('adminDatasetFile');
            const upStatus = document.getElementById('adminUploadStatus');
            if (upBtn && upFile) {
                upBtn.onclick = () => {
                    const file = upFile.files && upFile.files[0];
                    if (!file) { showToast('Select a dataset file first', 'error'); return; }
                    upStatus.textContent = `Uploading ${file.name}...`;
                    setTimeout(() => { upStatus.textContent = 'Processing...'; }, 800);
                    setTimeout(() => { upStatus.textContent = 'Completed'; showToast('Dataset uploaded'); }, 1800);
                };
            }
            const retrainBtn = document.getElementById('adminRetrainBtn');
            const retrainBar = document.getElementById('adminRetrainProgress');
            const retrainStatus = document.getElementById('adminRetrainStatus');
            if (retrainBtn && retrainBar) {
                retrainBtn.onclick = () => {
                    showToast('Retraining started');
                    let p = 0;
                    retrainStatus.textContent = 'Initializing...';
                    const t = setInterval(() => {
                        p = Math.min(100, p + Math.floor(5 + Math.random()*12));
                        retrainBar.style.width = p + '%';
                        retrainStatus.textContent = p < 100 ? `Training... ${p}%` : 'Retrain completed';
                        if (p >= 100) clearInterval(t);
                    }, 300);
                };
            }
            const cpu = document.getElementById('healthCPU');
            const mem = document.getElementById('healthMem');
            const up = document.getElementById('healthUptime');
            if (cpu && mem && up) {
                const seed = Date.now()%1000;
                const r = (b) => Math.min(99, Math.max(1, Math.round(50 + 40*Math.sin((Date.now()+b)/30000))));
                cpu.textContent = r(0) + '%';
                mem.textContent = r(5000) + '%';
                up.textContent = Math.floor((seed/37)%72) + 'h';
            }
            const logs = document.getElementById('adminLogs');
            const addLog = document.getElementById('adminAddLogBtn');
            function pushLog(msg, level) {
                if (!logs) return;
                const levelCls = level === 'error' ? 'text-red-700 bg-red-50 border-red-200' : level === 'warn' ? 'text-yellow-700 bg-yellow-50 border-yellow-200' : 'text-gray-700 bg-gray-50 border-gray-200';
                const div = document.createElement('div');
                div.className = `p-3 border rounded ${levelCls}`;
                const ts = new Date().toLocaleString();
                div.textContent = `[${ts}] ${msg}`;
                logs.prepend(div);
            }
            if (addLog) {
                addLog.onclick = () => {
                    const kinds = ['info','warn','error'];
                    const k = kinds[Math.floor(Math.random()*kinds.length)];
                    pushLog(k === 'error' ? 'Model inference failed on node-2' : k === 'warn' ? 'High latency detected (>800ms)' : 'Health check OK', k);
                };
            }
            const latCtx = document.getElementById('adminLatencyChart');
            if (latCtx && !latCtx.chart) {
                latCtx.chart = new Chart(latCtx, { type: 'line', data: { labels: Array.from({length: 12}, (_,i)=>`${i+1}m`), datasets: [{ label: 'p95 latency', data: Array.from({length: 12}, ()=> Math.round(300+Math.random()*400)), borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', tension: 0.35 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } } });
            }
            const thrCtx = document.getElementById('adminThroughputChart');
            if (thrCtx && !thrCtx.chart) {
                thrCtx.chart = new Chart(thrCtx, { type: 'bar', data: { labels: Array.from({length: 12}, (_,i)=>`${i+1}m`), datasets: [{ label: 'req/min', data: Array.from({length: 12}, ()=> Math.round(80+Math.random()*60)), backgroundColor: '#3b82f6', borderRadius: 8 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } } });
            }
        }

        // Navbar More dropdown handlers
        function toggleMoreDropdown() {
            const dd = document.getElementById('moreDropdown');
            if (!dd) return;
            dd.classList.toggle('hidden');
        }
        document.addEventListener('click', function(e) {
            const dd = document.getElementById('moreDropdown');
            const btn = document.getElementById('moreBtn');
            if (!dd || !btn) return;
            // If dropdown is open and click is outside both button and dropdown, close it
            if (!dd.classList.contains('hidden') && !dd.contains(e.target) && !btn.contains(e.target)) {
                dd.classList.add('hidden');
            }
        });

        // Incident Form handling + Geolocation + Recent Reports persistence
        document.addEventListener('DOMContentLoaded', function() {
            // Route Planner: UI bindings
            const depSel = document.getElementById('routeDepartureTime');
            const customInput = document.getElementById('routeCustomTime');
            if (depSel && customInput) {
                depSel.addEventListener('change', () => {
                    if (depSel.value === 'custom') { customInput.classList.remove('hidden'); }
                    else { customInput.classList.add('hidden'); }
                });
            }
            const useMyLocBtn = document.getElementById('routeUseMyLocationBtn');
            if (useMyLocBtn) {
                useMyLocBtn.addEventListener('click', async () => {
                    if (!navigator.geolocation) { showToast('Geolocation not supported.', 'error'); return; }
                    navigator.geolocation.getCurrentPosition(async (pos) => {
                        const { latitude, longitude } = pos.coords;
                        let label = `${latitude.toFixed(5)}, ${longitude.toFixed(5)}`;
                        try {
                            const r = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`);
                            if (r.ok) { const d = await r.json(); if (d && d.display_name) label = d.display_name; }
                        } catch {}
                        const inp = document.getElementById('routeOrigin');
                        if (inp) inp.value = label;
                    }, () => showToast('Unable to get your location.', 'error'));
                });
            }
            // Keep original Incident form markup to allow remount without full reload
            (function captureIncidentTemplate(){
                const c = document.getElementById('incidentFormContainer');
                if (c) window.__incidentFormHTML = c.innerHTML;
            })();
            // Image upload & preview for incidents
            const dropZone = document.getElementById('incidentDropZone');
            const fileInput = document.getElementById('incidentPhoto');
            const previewWrap = document.getElementById('incidentPhotoPreview');
            const previewImg = document.getElementById('incidentPhotoImg');
            let photoDataUrl = '';

            function setPreview(file) {
                if (!file) return;
                if (file.size > 10 * 1024 * 1024) {
                    alert('Image is too large. Max 10MB.');
                    return;
                }
                const reader = new FileReader();
                reader.onload = () => {
                    photoDataUrl = reader.result || '';
                    if (previewImg) previewImg.src = photoDataUrl;
                    if (previewWrap) previewWrap.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }

            if (dropZone && fileInput) {
                dropZone.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => {
                    const target = e.target;
                    const file = target && target.files ? target.files[0] : null;
                    if (file) setPreview(file);
                });
                dropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropZone.classList.add('border-blue-400');
                });
                dropZone.addEventListener('dragleave', () => dropZone.classList.remove('border-blue-400'));
                dropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropZone.classList.remove('border-blue-400');
                    const file = e.dataTransfer && e.dataTransfer.files ? e.dataTransfer.files[0] : null;
                    if (file) setPreview(file);
                });
            }
            // Geolocation: fill location field and center map
            const geolocateBtn = document.getElementById('useCurrentLocationBtn');
            if (geolocateBtn) {
                geolocateBtn.addEventListener('click', async function() {
                    const input = document.getElementById('incidentLocation');
                    if (!navigator.geolocation) {
                        showToast('Geolocation is not supported by your browser.', 'error');
                        return;
                    }
                    navigator.geolocation.getCurrentPosition(async (pos) => {
                        const { latitude, longitude } = pos.coords;
                        let label = `${latitude.toFixed(5)}, ${longitude.toFixed(5)}`;
                        try {
                            const resp = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`);
                            if (resp.ok) {
                                const data = await resp.json();
                                if (data && data.display_name) label = data.display_name;
                            }
                        } catch {}
                        if (input) input.value = label;
                        if (window.__leaflet && __leaflet.map) {
                            __leaflet.map.setView([latitude, longitude], 14);
                            // Add a temporary marker highlight
                            L.circleMarker([latitude, longitude], { radius: 10, color: '#06b6d4', fillColor: '#06b6d4', fillOpacity: 0.5 }).addTo(__leaflet.map);
                        }
                    }, () => showToast('Unable to retrieve your location.', 'error'));
                });
            }

            // Recent Reports: storage + renderer
            function loadReports() {
                try { return JSON.parse(localStorage.getItem('recentReports') || '[]'); } catch { return []; }
            }
            function saveReports(list) {
                localStorage.setItem('recentReports', JSON.stringify(list.slice(0, 20)));
            }
            function reportBadge(severity) {
                if (severity === 'high') return 'px-2 py-1 border border-red-200 text-red-700 text-xs rounded';
                if (severity === 'medium') return 'px-2 py-1 border border-yellow-200 text-yellow-700 text-xs rounded';
                return 'px-2 py-1 border border-green-200 text-green-700 text-xs rounded';
            }
            function emojiFor(type) {
                return type === 'accident' ? '🚗' : type === 'roadwork' ? '🚧' : type === 'hazard' ? '⚠️' : '🌧️';
            }
            function renderRecentReports() {
                const container = document.getElementById('recentReportsList');
                if (!container) return;
                const items = loadReports();
                container.innerHTML = items.map(it => `
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-start gap-3 mb-2">
                            <span class="text-2xl">${emojiFor(it.type)}</span>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1 flex-wrap">
                                    <span class="font-medium text-black">${it.typeLabel}</span>
                                    <span class="${reportBadge(it.severity)} text-xs">${it.severity}</span>
                                </div>
                                <p class="text-gray-600 text-sm break-words">${it.location}</p>
                                ${it.description ? `<p class="text-gray-500 text-sm break-words mt-1">${it.description}</p>` : ''}
                                ${it.photo ? `<img src="${it.photo}" alt="report image" class="mt-2 max-h-40 rounded-lg border border-gray-300">` : ''}
                                <div class="flex items-center gap-2 mt-2 text-sm text-gray-500">
                                    <span>${new Date(it.time).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            // initial render
            renderRecentReports();
            const incidentForm = document.getElementById('incidentForm');
            if (incidentForm) {
                incidentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Get form values
                    const type = document.getElementById('incidentType').value;
                    const location = document.getElementById('incidentLocation').value;
                    const description = document.getElementById('incidentDescription').value;

                    if (!type || !location) {
                        showToast('Please fill in all required fields', 'error');
                        return;
                    }

                    // Persist to recent reports
                    const typeLabel = type === 'accident' ? 'Accident' : type === 'roadwork' ? 'Roadwork' : type === 'hazard' ? 'Road Hazard' : 'Weather';
                    const severity = type === 'accident' ? 'high' : type === 'roadwork' ? 'medium' : 'low';
                    const reports = loadReports();
                    reports.unshift({ type, typeLabel, severity, location, description, time: Date.now(), photo: photoDataUrl });
                    saveReports(reports);
                    renderRecentReports();
                    // Toast: success
                    showToast('Incident report submitted successfully!', 'success');

                    // Show success message
                    const container = document.getElementById('incidentFormContainer');
                    container.innerHTML = `
                        <div class="py-12 text-center">
                            <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4">
                                <i data-lucide="check-circle-2" class="w-8 h-8 text-green-600"></i>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">Report Submitted Successfully!</h3>
                            <p class="text-gray-600 mb-6">
                                Thank you for helping the community. Your report is being verified.
                            </p>
                            <button onclick="resetIncidentForm()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors">
                                Report Another Incident
                            </button>
                        </div>
                    `;

                    // Re-initialize icons
                    lucide.createIcons();

                    // Stay on Incident Reporter; user can click the button to report another without going Home
                });
            }
            // Helper to re-mount the incident form after success without leaving the page
            window.__wireIncidentForm = function(){
                // Re-bind image upload and preview
                const dropZone2 = document.getElementById('incidentDropZone');
                const fileInput2 = document.getElementById('incidentPhoto');
                const previewWrap2 = document.getElementById('incidentPhotoPreview');
                const previewImg2 = document.getElementById('incidentPhotoImg');
                let photoDataUrl2 = '';
                function setPreview2(file){
                    if (!file) return;
                    if (file.size > 10 * 1024 * 1024) { alert('Image is too large. Max 10MB.'); return; }
                    const r = new FileReader();
                    r.onload = () => { photoDataUrl2 = r.result || ''; if (previewImg2) previewImg2.src = photoDataUrl2; if (previewWrap2) previewWrap2.classList.remove('hidden'); };
                    r.readAsDataURL(file);
                }
                if (dropZone2 && fileInput2) {
                    dropZone2.addEventListener('click', () => fileInput2.click());
                    fileInput2.addEventListener('change', (e) => { const t = e.target; const f = t && t.files ? t.files[0] : null; if (f) setPreview2(f); });
                    dropZone2.addEventListener('dragover', (e) => { e.preventDefault(); dropZone2.classList.add('border-blue-400'); });
                    dropZone2.addEventListener('dragleave', () => dropZone2.classList.remove('border-blue-400'));
                    dropZone2.addEventListener('drop', (e) => { e.preventDefault(); dropZone2.classList.remove('border-blue-400'); const f = e.dataTransfer && e.dataTransfer.files ? e.dataTransfer.files[0] : null; if (f) setPreview2(f); });
                }
                // Re-bind geolocation
                const geolocateBtn2 = document.getElementById('useCurrentLocationBtn');
                if (geolocateBtn2) {
                    geolocateBtn2.addEventListener('click', async function(){
                        const input = document.getElementById('incidentLocation');
                        if (!navigator.geolocation) { showToast('Geolocation is not supported by your browser.', 'error'); return; }
                        navigator.geolocation.getCurrentPosition(async (pos) => {
                            const { latitude, longitude } = pos.coords;
                            let label = `${latitude.toFixed(5)}, ${longitude.toFixed(5)}`;
                            try { const resp = await fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`); if (resp.ok) { const data = await resp.json(); if (data && data.display_name) label = data.display_name; } } catch {}
                            if (input) input.value = label;
                            if (window.__leaflet && __leaflet.map) { __leaflet.map.setView([latitude, longitude], 14); L.circleMarker([latitude, longitude], { radius: 10, color: '#06b6d4', fillColor: '#06b6d4', fillOpacity: 0.5 }).addTo(__leaflet.map); }
                        }, () => showToast('Unable to retrieve your location.', 'error'));
                    });
                }
                // Re-bind submit
                const form2 = document.getElementById('incidentForm');
                if (form2) {
                    form2.addEventListener('submit', function(e){
                        e.preventDefault();
                        const type = document.getElementById('incidentType').value;
                        const location = document.getElementById('incidentLocation').value;
                        const description = document.getElementById('incidentDescription').value;
                        if (!type || !location) { showToast('Please fill in all required fields', 'error'); return; }
                        const typeLabel = type === 'accident' ? 'Accident' : type === 'roadwork' ? 'Roadwork' : type === 'hazard' ? 'Road Hazard' : 'Weather';
                        const severity = type === 'accident' ? 'high' : type === 'roadwork' ? 'medium' : 'low';
                        const reports = (function(){ try { return JSON.parse(localStorage.getItem('recentReports')||'[]'); } catch { return []; } })();
                        reports.unshift({ type, typeLabel, severity, location, description, time: Date.now(), photo: photoDataUrl2 });
                        localStorage.setItem('recentReports', JSON.stringify(reports.slice(0,20)));
                        if (typeof renderRecentReports === 'function') { renderRecentReports(); }
                        // Toast: success
                        showToast('Incident report submitted successfully!', 'success');
                        // Show success message again after second submit
                        const container2 = document.getElementById('incidentFormContainer');
                        container2.innerHTML = `
                            <div class="py-12 text-center">
                                <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4">
                                    <i data-lucide="check-circle-2" class="w-8 h-8 text-green-600"></i>
                                </div>
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">Report Submitted Successfully!</h3>
                                <p class="text-gray-600 mb-6">Thank you for helping the community. Your report is being verified.</p>
                                <button onclick="resetIncidentForm()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors">Report Another Incident</button>
                            </div>`;
                        lucide.createIcons();
                    });
                }
            };
        });

        function resetIncidentForm() {
            // Remount original incident form and stay on the incident reporter page
            navigateTo('incident-reporter');
            const container = document.getElementById('incidentFormContainer');
            if (container && window.__incidentFormHTML) {
                container.innerHTML = window.__incidentFormHTML;
                lucide.createIcons();
                if (window.__wireIncidentForm) window.__wireIncidentForm();
            }
        }

        // Modern fade-up reveal on scroll/load
        (function() {
            let revealObserver;
            function initRevealObserver() {
                if (revealObserver) return revealObserver;
                revealObserver = new IntersectionObserver((entries) => {
                    for (const entry of entries) {
                        const el = entry.target;
                        if (entry.isIntersecting) {
                            el.classList.add('in');
                            revealObserver.unobserve(el);
                        }
                    }
                }, { threshold: 0.18, rootMargin: '0px 0px -40px 0px' });
                return revealObserver;
            }

            function tagAndObserve(containerSelector, step = 0.06) {
                const container = document.querySelector(containerSelector);
                if (!container) return;
                const els = Array.from(container.querySelectorAll('[data-animate], h1, h2, h3, p, button, .p-6'))
                  .filter((el) => el.offsetParent !== null);
                els.forEach((el, i) => {
                    if (!el.hasAttribute('data-animate')) el.setAttribute('data-animate', '');
                    el.style.setProperty('--delay', `${Math.min(i * step, 0.6)}s`);
                    initRevealObserver().observe(el);
                });
            }

            function setupRevealAnimations() {
                // Home hero and features
                tagAndObserve('#home-page');
                tagAndObserve('#features');
                // Also prepare other sections when navigated
                tagAndObserve('#traffic-map-page');
            }

            // Expose for navigation callbacks if needed
            window.__setupRevealAnimations = setupRevealAnimations;
            window.__revealPage = function(selector) {
                const root = document.querySelector(selector);
                if (!root) return;
                // Reset previous animated state so it can animate again
                root.querySelectorAll('[data-animate].in').forEach((el) => {
                    el.classList.remove('in');
                });
                // Re-tag and observe children within this page
                tagAndObserve(selector);
            };
        })();

        // Initialize on load
        window.addEventListener('load', function() {
            let startPage = 'home';
            try {
                const saved = localStorage.getItem('currentPage');
                if (saved && document.getElementById(saved + '-page')) startPage = saved;
            } catch {}
            navigateTo(startPage);
            if (window.__setupRevealAnimations) window.__setupRevealAnimations();
            // Ensure top after restoration
            window.scrollTo({ top: 0, behavior: 'auto' });
            // If starting on route planner, clear any prefilled values
            if (startPage === 'route-planner') {
                const o = document.getElementById('routeOrigin');
                const d = document.getElementById('routeDestination');
                if (o) o.value = '';
                if (d) d.value = '';
            }
        });
    </script>
</body>
</html>
